<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap');

        :root {
            --pink: #ffb7c5;
            --hot-pink: #ff4d6d;
            --cream: #fff5f5;
        }

        /* Prevent scrolling and zooming on mobile */
        * { touch-action: manipulation; box-sizing: border-box; }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--pink);
            font-family: 'Silkscreen', cursive;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        #game-container {
            width: 100%; height: 100%;
            max-width: 500px; /* Looks like a phone on desktop */
            max-height: 900px;
            background: var(--cream);
            position: relative;
            overflow: hidden;
            border: 4px solid white;
        }

        /* Adaptive Header for Notches */
        #ui-layer {
            position: absolute; 
            top: env(safe-area-inset-top, 20px); 
            left: 20px; right: 20px;
            z-index: 100; display: none; justify-content: space-between;
            pointer-events: none;
        }

        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 30px;
            background: var(--cream);
            z-index: 10;
        }

        .hidden { display: none !important; }

        .btn {
            background: var(--hot-pink); color: white;
            border: none; padding: 15px 25px; 
            border-radius: 50px;
            font-family: 'Silkscreen', cursive;
            font-size: 14px; cursor: pointer;
            box-shadow: 0 6px 0 #c9184a;
            margin: 10px;
            width: 80%;
            max-width: 300px;
            -webkit-tap-highlight-color: transparent;
        }

        .btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #c9184a; }

        #no-btn { 
            position: absolute; z-index: 9999; 
            width: auto !important; background: #ff85a1;
            transition: all 0.15s ease-out;
        }

        canvas { display: none; width: 100%; height: 100%; background: #fff0f3; touch-action: none; }

        /* Mobile Responsive Grid */
        #memory-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); 
            gap: 8px; width: 100%; max-width: 320px; 
        }
        .card { 
            aspect-ratio: 1/1; background: var(--hot-pink); 
            border-radius: 8px; display: flex; align-items: center; 
            justify-content: center; font-size: 24px; color: transparent;
        }
        .card.flipped { background: white; color: initial; }
        .card.matched { visibility: hidden; }

        #letter-overlay {
            position: absolute; inset: 10%;
            background: #fffafa; border: 4px solid var(--hot-pink);
            border-radius: 15px; padding: 20px;
            z-index: 5000; overflow-y: auto;
            display: none; flex-direction: column;
        }

        #boss-ui { position: absolute; bottom: 40px; left: 10%; width: 80%; display: none; z-index: 100; }
        #boss-bar-bg { width: 100%; height: 12px; background: #eee; border: 2px solid #333; border-radius: 10px; overflow: hidden; }
        #boss-hp { width: 100%; height: 100%; background: var(--hot-pink); transition: width 0.2s; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-layer">
        <div id="heart-bar">‚ù§Ô∏è</div>
        <div id="lvl-display">LVL: 1</div>
    </div>

    <div id="letter-overlay">
        <h2 style="font-size: 18px;">A Special Letter üíå</h2>
        <div style="font-family: sans-serif; font-size: 15px; line-height: 1.6; color: #444; text-align: left; margin: 15px 0;">
            Dear [Name],<br><br>
            Happy 1st Month! üçì<br><br>
            Defeating the "Distance Boss" was just a game, but every day with you is a real win. Thank you for an amazing first month. I'm so lucky to have you.<br><br>
            I love you so much!<br><br>
            Yours,<br>
            [Your Name]
        </div>
        <button class="btn" onclick="closeLetter()">CLOSE</button>
    </div>

    <div id="instruction-screen" class="screen hidden">
        <h2 id="ins-title"></h2>
        <p id="ins-text" style="font-size: 14px; margin: 20px 0;"></p>
        <button id="start-lvl-btn" class="btn" onclick="initLevelTimer()">START</button>
        <div id="countdown" style="font-size: 40px; color: var(--hot-pink); margin-top: 10px;"></div>
    </div>

    <div id="scr-intro" class="screen">
        <div style="font-size: 60px; margin-bottom: 20px;">üçì</div>
        <h1>Strawberry Multiverse</h1>
        <button class="btn" onclick="goToStep(1)">PLAY!</button>
    </div>

    <div id="scr-love2" class="screen hidden">
        <h1 style="font-size: 22px;">Do you REALLY<br>love me?</h1>
        <button class="btn" style="z-index: 5;" onclick="nextLevel()">YES!</button>
        <button id="no-btn" class="btn">NO</button>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h2 id="q-num">Q1</h2>
        <p id="q-text"></p>
        <div id="quiz-options" style="width: 100%;"></div>
    </div>

    <div id="scr-memory" class="screen hidden">
        <div id="memory-grid"></div>
    </div>

    <canvas id="mainCanvas"></canvas>

    <div id="scr-final" class="screen hidden">
        <h1>VICTORY!</h1>
        <div style="font-size: 80px;">üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©</div>
        <button class="btn" onclick="openLetter()">READ MY LETTER üíå</button>
    </div>

    <div id="boss-ui">
        <div id="boss-bar-bg"><div id="boss-hp"></div></div>
    </div>
</div>

<script>
    const state = { level: 0, hearts: 5, quizIndex: 0, isPaused: true, bossHP: 100 };
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('game-container');
    const noBtn = document.getElementById('no-btn');

    // Adaptive Canvas Size
    function resizeCanvas() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // TROLL NO BUTTON
    function teleportNoButton() {
        const x = Math.random() * (container.clientWidth - noBtn.offsetWidth - 40) + 20;
        const y = Math.random() * (container.clientHeight - noBtn.offsetHeight - 40) + 20;
        noBtn.style.left = `${x}px`;
        noBtn.style.top = `${y}px`;
    }
    noBtn.addEventListener('mouseover', teleportNoButton);
    noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); teleportNoButton(); });

    // Proximity Detection for Mobile/Desktop
    const handleMove = (e) => {
        if (document.getElementById('scr-love2').classList.contains('hidden')) return;
        const pointer = e.touches ? e.touches[0] : e;
        const rect = noBtn.getBoundingClientRect();
        const dist = Math.hypot(pointer.clientX - (rect.left + rect.width/2), pointer.clientY - (rect.top + rect.height/2));
        if (dist < 80) teleportNoButton();
    };
    document.addEventListener('mousemove', handleMove);
    document.addEventListener('touchmove', handleMove, { passive: false });

    // NAVIGATION
    function goToStep(s) { 
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        if(s===1) document.getElementById('scr-love2').classList.remove('hidden'); 
    }
    function updateHearts() { document.getElementById('heart-bar').innerText = "‚ù§Ô∏è".repeat(state.hearts); }
    function openLetter() { document.getElementById('letter-overlay').style.display = 'flex'; }
    function closeLetter() { document.getElementById('letter-overlay').style.display = 'none'; }

    function nextLevel() {
        state.level++; state.isPaused = true;
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        canvas.style.display = 'none'; document.getElementById('boss-ui').style.display = 'none';
        document.getElementById('ui-layer').style.display = 'flex';
        document.getElementById('lvl-display').innerText = "LVL: " + state.level;
        
        const info = [
            null,
            {t: "LVL 1: Connection", d: "Sync our hearts with 10 questions!"},
            {t: "LVL 2: Impact", d: "Shoot the obstacles! Drag to move."},
            {t: "LVL 3: Harvest", d: "Catch the strawberries! Avoid the üíî"},
            {t: "LVL 4: Memories", d: "Match the emoji pairs!"},
            {t: "FINAL BOSS", d: "Defeat The Distance! Drag to move and shoot!"}
        ][state.level];

        if(info) {
            document.getElementById('ins-title').innerText = info.t;
            document.getElementById('ins-text').innerText = info.d;
            document.getElementById('instruction-screen').classList.remove('hidden');
        } else {
            document.getElementById('scr-final').classList.remove('hidden');
            document.getElementById('ui-layer').style.display = 'none';
        }
    }

    function initLevelTimer() {
        let c = 3; const cd = document.getElementById('countdown');
        const t = setInterval(() => { 
            cd.innerText = c > 0 ? c : "GO!"; 
            if(c-- < 0) { clearInterval(t); startLvl(); } 
        }, 800);
    }

    function startLvl() {
        document.getElementById('instruction-screen').classList.add('hidden');
        state.isPaused = false;
        if(state.level === 1) startQuiz();
        else if(state.level === 5) { document.getElementById('boss-ui').style.display = 'block'; startBoss(); }
        else { canvas.style.display = 'block'; if(state.level===2) startImpact(); if(state.level===3) startHarvest(); if(state.level===4) startMem(); }
    }

    // --- LEVEL LOGICS (SIMPLIFIED FOR MOBILE PERFORMANCE) ---
    function startQuiz() {
        document.getElementById('scr-quiz').classList.remove('hidden');
        const qData = ["Who yaps more?", "Who falls asleep first?", "Best hugger?", "Who fell first?", "Who is more stubborn?", "Favorite date?", "Morning person?", "More protective?", "Who is the cutest?", "Ready for Month 2?"];
        const qIdx = state.quizIndex;
        document.getElementById('q-num').innerText = `Q${qIdx+1}`;
        document.getElementById('q-text').innerText = qData[qIdx];
        const opt = document.getElementById('quiz-options'); opt.innerHTML = '';
        ["Me", "You"].forEach(o => {
            const b = document.createElement('button'); b.className = 'btn'; b.innerText = o;
            b.onclick = () => { state.quizIndex++; if(state.quizIndex < 10) startQuiz(); else nextLevel(); };
            opt.appendChild(b);
        });
    }

    function startImpact() {
        let ship = {x: 50, y: canvas.height/2}, seeds = [], enemies = [], f = 0;
        const move = (e) => { 
            const p = e.touches ? e.touches[0] : e;
            ship.y = p.clientY - canvas.getBoundingClientRect().top;
        };
        canvas.onmousemove = move; canvas.ontouchmove = (e) => { e.preventDefault(); move(e); };
        function loop() {
            if(state.isPaused || state.level !== 2) return;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.font = "30px Arial"; ctx.fillText("üçì", ship.x, ship.y);
            if(f % 15 === 0) seeds.push({x: ship.x+20, y: ship.y-10});
            seeds.forEach((s,i) => { s.x += 7; ctx.fillText("üå±", s.x, s.y); if(s.x > canvas.width) seeds.splice(i,1); });
            if(f % 40 === 0) enemies.push({x: canvas.width, y: Math.random()*canvas.height, t: "üö©"});
            enemies.forEach((en,i) => {
                en.x -= 4; ctx.fillText(en.t, en.x, en.y);
                if(en.x < 50 && Math.abs(en.y - ship.y) < 30) { state.hearts--; updateHearts(); enemies.splice(i,1); }
                seeds.forEach((sd,si) => { if(Math.hypot(sd.x-en.x, sd.y-en.y) < 30) { enemies.splice(i,1); seeds.splice(si,1); }});
            });
            f++; if(f > 600) nextLevel(); else requestAnimationFrame(loop);
        } loop();
    }

    function startHarvest() {
        let basket = {x: canvas.width/2, y: canvas.height - 80}, items = [], f = 0;
        const move = (e) => {
            const p = e.touches ? e.touches[0] : e;
            basket.x = p.clientX - canvas.getBoundingClientRect().left - 25;
        };
        canvas.onmousemove = move; canvas.ontouchmove = (e) => { e.preventDefault(); move(e); };
        function loop() {
            if(state.isPaused || state.level !== 3) return;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.font = "50px Arial"; ctx.fillText("üß∫", basket.x, basket.y);
            if(f % 30 === 0) items.push({x: Math.random()*(canvas.width-30), y: 0, t: Math.random() > 0.2 ? "üçì" : "üíî"});
            items.forEach((it, i) => {
                it.y += 5; ctx.font = "30px Arial"; ctx.fillText(it.t, it.x, it.y);
                if(it.y > basket.y - 30 && it.x > basket.x - 20 && it.x < basket.x + 50) {
                    if(it.t === "üíî") { state.hearts--; updateHearts(); }
                    items.splice(i,1);
                }
            });
            f++; if(f > 600) nextLevel(); else requestAnimationFrame(loop);
        } loop();
    }

    function startMem() {
        document.getElementById('scr-memory').classList.remove('hidden');
        const grid = document.getElementById('memory-grid'); grid.innerHTML = '';
        let pairs = 0; let items = ['üçì','üíñ','üìû','üéÆ','üç∞','üéÅ'];
        let cards = [...items, ...items].sort(() => Math.random()-0.5);
        let flipped = [];
        cards.forEach(emoji => {
            const div = document.createElement('div'); div.className = 'card'; div.dataset.val = emoji; div.innerText = emoji;
            div.onclick = () => {
                if(flipped.length < 2 && !div.classList.contains('flipped')) {
                    div.classList.add('flipped'); flipped.push(div);
                    if(flipped.length === 2) {
                        if(flipped[0].dataset.val === flipped[1].dataset.val) {
                            pairs++; flipped = []; if(pairs === 6) nextLevel();
                        } else {
                            setTimeout(() => { flipped.forEach(c => c.classList.remove('flipped')); flipped = []; }, 600);
                        }
                    }
                }
            }; grid.appendChild(div);
        });
    }

    function startBoss() {
        canvas.style.display = 'block';
        let ship = {x: 50, y: canvas.height/2}, boss = {x: canvas.width - 80, y: canvas.height/2, d: 1}, seeds = [], bullets = [], f = 0;
        const move = (e) => {
            const p = e.touches ? e.touches[0] : e;
            const r = canvas.getBoundingClientRect();
            ship.x = p.clientX - r.left; ship.y = p.clientY - r.top;
        };
        canvas.onmousemove = move; canvas.ontouchmove = (e) => { e.preventDefault(); move(e); };
        function loop() {
            if(state.isPaused || state.level !== 5) return;
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.font = "30px Arial"; ctx.fillText("üçì", ship.x-15, ship.y+10);
            boss.y += 4 * boss.d; if(boss.y > canvas.height-50 || boss.y < 50) boss.d *= -1;
            ctx.font = "60px Arial"; ctx.fillText("üåè", boss.x-30, boss.y+20);
            if(f % 15 === 0) seeds.push({x: ship.x, y: ship.y});
            seeds.forEach((s,i) => {
                s.x += 10; ctx.font="15px Arial"; ctx.fillText("üå±", s.x, s.y);
                if(s.x > boss.x - 30 && Math.abs(s.y - boss.y) < 40) { state.bossHP -= 2; seeds.splice(i,1); document.getElementById('boss-hp').style.width = state.bossHP + "%"; }
            });
            if(f % 40 === 0) bullets.push({x: boss.x, y: boss.y, vx: -6});
            bullets.forEach((b,i) => {
                b.x += b.vx; ctx.fillText("‚úàÔ∏è", b.x, b.y);
                if(Math.hypot(b.x-ship.x, b.y-ship.y) < 30) { state.hearts--; updateHearts(); bullets.splice(i,1); }
            });
            f++; if(state.bossHP <= 0) nextLevel(); else requestAnimationFrame(loop);
        } loop();
    }
</script>
</body>
</html>
