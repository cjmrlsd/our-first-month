<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap');

        :root {
            --pink: #ffb7c5;
            --hot-pink: #ff4d6d;
            --cream: #fff5f5;
            --glow: 0 0 10px rgba(255, 77, 109, 0.5);
        }

        * { touch-action: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #000; /* Contrast for the game box */
            font-family: 'Silkscreen', cursive;
            overflow: hidden; display: flex; justify-content: center; align-items: center;
        }

        #game-container {
            width: 100%; height: 100%;
            max-width: 450px; max-height: 850px;
            background: var(--cream);
            position: relative; overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        /* Screen Shake Effect */
        .shake { animation: shake 0.2s ease-in-out; }
        @keyframes shake {
            0%, 100% { transform: translate(0,0); }
            25% { transform: translate(-4px, 4px); }
            50% { transform: translate(4px, -4px); }
            75% { transform: translate(-4px, -4px); }
        }

        #ui-layer {
            position: absolute; top: env(safe-area-inset-top, 20px);
            left: 20px; right: 20px; z-index: 100;
            display: none; justify-content: space-between; pointer-events: none;
        }

        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 30px; z-index: 10;
        }

        .hidden { display: none !important; }

        .btn {
            background: var(--hot-pink); color: white;
            border: none; padding: 18px; border-radius: 50px;
            font-family: 'Silkscreen', cursive; font-size: 14px;
            cursor: pointer; box-shadow: 0 6px 0 #c9184a;
            margin: 10px; width: 80%; transition: 0.1s;
        }

        .btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #c9184a; }

        #no-btn { 
            position: absolute; z-index: 9999; 
            width: auto !important; background: #ff85a1;
            transition: all 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        canvas { display: none; width: 100%; height: 100%; background: #fff0f3; }

        #memory-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; }
        .card { 
            aspect-ratio: 1/1; background: var(--hot-pink); border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 28px;
            color: transparent; transition: 0.3s;
        }
        .card.flipped { background: white; color: initial; transform: rotateY(180deg); }

        #letter-overlay {
            position: absolute; inset: 8%; background: #fffafa;
            border: 4px solid var(--hot-pink); border-radius: 20px;
            padding: 25px; z-index: 5000; overflow-y: auto;
            display: none; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        #boss-ui { position: absolute; top: 80px; left: 10%; width: 80%; display: none; }
        #boss-bar-bg { width: 100%; height: 15px; background: #333; border-radius: 10px; overflow: hidden; }
        #boss-hp { width: 100%; height: 100%; background: linear-gradient(90deg, #ff4d6d, #ff85a1); transition: 0.3s; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-layer">
        <div id="heart-bar" style="filter: drop-shadow(0 0 5px red);">‚ù§Ô∏è</div>
        <div id="lvl-display">LVL: 1</div>
    </div>

    <div id="letter-overlay">
        <h2 style="font-size: 18px; color: var(--hot-pink);">A Special Letter üíå</h2>
        <div style="font-family: 'Courier New', Courier, monospace; font-size: 15px; line-height: 1.6; color: #333; text-align: left; margin: 15px 0;">
            Dear [Name],<br><br>
            Happy 1st Month! üçì<br><br>
            They say the first month is just the beginning, but with you, it feels like I've found my favorite person in the entire multiverse.<br><br>
            Thank you for every laugh, every yap, and every moment. You make the world (and this game) so much brighter.<br><br>
            I love you more than all the strawberries in the world.<br><br>
            Yours Forever,<br>
            [Your Name]
        </div>
        <button class="btn" onclick="closeLetter()">CLOSE</button>
    </div>

    <div id="scr-intro" class="screen">
        <div style="font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 10px 0px rgba(0,0,0,0.1));">üçì</div>
        <h1 style="font-size: 24px; margin: 0;">STRAWBERRY<br>MULTIVERSE</h1>
        <p style="font-size: 10px; color: #888; margin-top: 10px;">PRO VERSION 1.0</p>
        <button class="btn" onclick="goToStep(1)">START ADVENTURE</button>
    </div>

    <div id="scr-love2" class="screen hidden">
        <h1 style="font-size: 22px;">DO YOU REALLY<br>LOVE ME?</h1>
        <button class="btn" onclick="nextLevel()">YES!</button>
        <button id="no-btn" class="btn">NO</button>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h2 id="q-num" style="font-size: 14px;">Q1</h2>
        <p id="q-text" style="height: 50px;"></p>
        <div id="quiz-options" style="width: 100%;"></div>
    </div>

    <div id="scr-memory" class="screen hidden">
        <h2 style="font-size: 16px;">MEMORY SYNC</h2>
        <div id="memory-grid"></div>
    </div>

    <canvas id="mainCanvas"></canvas>

    <div id="boss-ui">
        <div style="font-size: 10px; color: #333; margin-bottom: 5px;">DISTANCE BOSS</div>
        <div id="boss-bar-bg"><div id="boss-hp"></div></div>
    </div>

    <div id="scr-final" class="screen hidden">
        <h1 style="font-size: 28px;">VICTORY!</h1>
        <div style="font-size: 100px; margin: 20px;">üçì‚ú®</div>
        <button class="btn" onclick="openLetter()">READ MY LETTER üíå</button>
    </div>

    <div id="instruction-screen" class="screen hidden" style="background: rgba(255,245,245,0.95);">
        <h2 id="ins-title"></h2>
        <p id="ins-text" style="font-size: 14px;"></p>
        <div id="countdown" style="font-size: 50px; margin-top: 20px;"></div>
    </div>
</div>

<script>
    // --- PRO ENGINE STATE ---
    const state = { 
        level: 0, hearts: 5, quizIndex: 0, isPaused: true, 
        bossHP: 100, particles: [], 
        player: { x: 0, y: 0, targetX: 0, targetY: 0 },
        screenShake: 0
    };

    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('game-container');
    const noBtn = document.getElementById('no-btn');

    function resize() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- JUICE SYSTEM ---
    function spawnParticles(x, y, color, count = 8) {
        for(let i=0; i<count; i++) {
            state.particles.push({
                x, y, 
                vx: (Math.random()-0.5)*12, 
                vy: (Math.random()-0.5)*12, 
                life: 1.0, 
                color 
            });
        }
    }

    function updateParticles() {
        for(let i=state.particles.length-1; i>=0; i--) {
            let p = state.particles[i];
            p.x += p.vx; p.y += p.vy; p.life -= 0.04;
            if(p.life <= 0) state.particles.splice(i,1);
            else {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5);
            }
        }
        ctx.globalAlpha = 1;
    }

    function triggerHit() {
        state.hearts--;
        updateHearts();
        container.classList.add('shake');
        setTimeout(() => container.classList.remove('shake'), 200);
    }

    // --- TROLL LOGIC ---
    function teleportNo() {
        const x = Math.random() * (container.clientWidth - 100) + 20;
        const y = Math.random() * (container.clientHeight - 60) + 20;
        noBtn.style.left = `${x}px`;
        noBtn.style.top = `${y}px`;
        spawnParticles(x + 40, y + 20, '#ff85a1', 5);
    }
    noBtn.addEventListener('mouseover', teleportNo);
    noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); teleportNo(); });

    document.addEventListener('mousemove', (e) => {
        if(state.level !== 0 || document.getElementById('scr-love2').classList.contains('hidden')) return;
        const r = noBtn.getBoundingClientRect();
        if(Math.hypot(e.clientX - (r.left + r.width/2), e.clientY - (r.top + r.height/2)) < 85) teleportNo();
    });

    // --- PLAYER MOVEMENT (LERPING) ---
    const updateTarget = (e) => {
        const p = e.touches ? e.touches[0] : e;
        const r = canvas.getBoundingClientRect();
        state.player.targetX = p.clientX - r.left;
        state.player.targetY = p.clientY - r.top;
    };
    canvas.addEventListener('mousemove', updateTarget);
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); updateTarget(e); }, {passive:false});

    // --- GAME FLOW ---
    function goToStep(s) {
        document.getElementById('scr-intro').classList.add('hidden');
        document.getElementById('scr-love2').classList.remove('hidden');
    }

    function nextLevel() {
        state.level++; state.isPaused = true;
        document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
        canvas.style.display = 'none'; document.getElementById('boss-ui').style.display = 'none';
        document.getElementById('ui-layer').style.display = 'flex';
        document.getElementById('lvl-display').innerText = `LVL: ${state.level}`;
        
        const data = [
            null,
            {t: "LVL 1: SYNC", d: "Sync our hearts with 10 facts."},
            {t: "LVL 2: IMPACT", d: "Clear the hazard zone! Drag to move."},
            {t: "LVL 3: HARVEST", d: "Gather strawberries, avoid heartbreak."},
            {t: "LVL 4: MEMORY", d: "Find the matching pairs."},
            {t: "FINAL: DISTANCE", d: "Defeat the Distance Boss!"}
        ][state.level];

        if(data) {
            document.getElementById('ins-title').innerText = data.t;
            document.getElementById('ins-text').innerText = data.d;
            document.getElementById('instruction-screen').classList.remove('hidden');
            document.getElementById('countdown').innerText = "";
        } else showFinal();
    }

    function initLevelTimer() {
        let c = 3; 
        const cd = document.getElementById('countdown');
        const itv = setInterval(() => {
            cd.innerText = c > 0 ? c : "GO!";
            if(c-- < 0) { clearInterval(itv); startActualLvl(); }
        }, 800);
    }

    function startActualLvl() {
        document.getElementById('instruction-screen').classList.add('hidden');
        state.isPaused = false;
        if(state.level === 1) startQuiz();
        else if(state.level === 4) startMem();
        else {
            canvas.style.display = 'block';
            if(state.level === 5) document.getElementById('boss-ui').style.display = 'block';
            runGameLoop();
        }
    }

    // --- GAME LOOPS ---
    let objects = [], frames = 0;
    function runGameLoop() {
        if(state.isPaused) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        
        // Smooth Player Follow
        state.player.x += (state.player.targetX - state.player.x) * 0.2;
        state.player.y += (state.player.targetY - state.player.y) * 0.2;

        if(state.level === 2) {
            if(frames % 20 === 0) objects.push({x: canvas.width, y: Math.random()*canvas.height, t: 'hazard'});
            objects.forEach((o, i) => {
                o.x -= 6; ctx.font = "24px Arial"; ctx.fillText("üö©", o.x, o.y);
                if(Math.hypot(o.x - state.player.x, o.y - state.player.y) < 30) { triggerHit(); objects.splice(i,1); }
            });
            ctx.font = "40px Arial"; ctx.fillText("üçì", state.player.x - 20, state.player.y + 15);
            if(frames > 500) { objects = []; nextLevel(); return; }
        }

        if(state.level === 3) {
            if(frames % 25 === 0) objects.push({x: Math.random()*canvas.width, y: -50, t: Math.random() > 0.2 ? 'berry' : 'bad'});
            objects.forEach((o, i) => {
                o.y += 5; ctx.font = "30px Arial"; ctx.fillText(o.t === 'berry' ? "üçì" : "üíî", o.x, o.y);
                if(Math.hypot(o.x - state.player.x, o.y - state.player.y) < 40) {
                    if(o.t === 'bad') triggerHit();
                    else spawnParticles(o.x, o.y, '#ff4d6d');
                    objects.splice(i,1);
                }
            });
            ctx.font = "50px Arial"; ctx.fillText("üß∫", state.player.x - 25, canvas.height - 60);
            if(frames > 600) { objects = []; nextLevel(); return; }
        }

        if(state.level === 5) {
            let bossY = Math.sin(frames * 0.05) * (canvas.height/3) + (canvas.height/2);
            ctx.font = "80px Arial"; ctx.fillText("üåè", canvas.width - 100, bossY + 30);
            ctx.font = "30px Arial"; ctx.fillText("üçì", state.player.x - 15, state.player.y + 15);
            
            if(frames % 10 === 0) objects.push({x: state.player.x, y: state.player.y, type: 'bullet'});
            objects.forEach((o, i) => {
                o.x += 12; ctx.fillText("üå±", o.x, o.y);
                if(o.x > canvas.width - 100 && Math.abs(o.y - bossY) < 50) {
                    state.bossHP -= 1.5;
                    document.getElementById('boss-hp').style.width = state.bossHP + "%";
                    spawnParticles(o.x, o.y, '#4dff88', 3);
                    objects.splice(i,1);
                }
            });
            if(state.bossHP <= 0) { nextLevel(); return; }
        }

        updateParticles();
        frames++;
        requestAnimationFrame(runGameLoop);
    }

    function startQuiz() {
        document.getElementById('scr-quiz').classList.remove('hidden');
        const qs = ["Who yaps more?", "Who falls asleep during movies?", "Who gives better hugs?", "Who fell in love first?", "Who is the morning person?", "Who is more stubborn?", "Who is the cutest?", "Who is more protective?", "Ready for Month 2?", "Forever?"];
        document.getElementById('q-text').innerText = qs[state.quizIndex];
        const opt = document.getElementById('quiz-options'); opt.innerHTML = '';
        ["Me", "You"].forEach(o => {
            const b = document.createElement('button'); b.className = 'btn'; b.innerText = o;
            b.onclick = () => { 
                spawnParticles(window.innerWidth/2, window.innerHeight/2, '#ffb7c5', 15);
                state.quizIndex++; 
                if(state.quizIndex < 10) startQuiz(); 
                else nextLevel(); 
            };
            opt.appendChild(b);
        });
    }

    function startMem() {
        document.getElementById('scr-memory').classList.remove('hidden');
        const grid = document.getElementById('memory-grid'); grid.innerHTML = '';
        let matched = 0; let cards = ['üçì','üíñ','üìû','üéÆ','üç∞','üéÅ'];
        let deck = [...cards, ...cards].sort(() => Math.random() - 0.5);
        let active = [];
        deck.forEach(emoji => {
            const d = document.createElement('div'); d.className = 'card'; d.dataset.v = emoji; d.innerText = emoji;
            d.onclick = () => {
                if(active.length < 2 && !d.classList.contains('flipped')) {
                    d.classList.add('flipped'); active.push(d);
                    if(active.length === 2) {
                        if(active[0].dataset.v === active[1].dataset.v) {
                            matched++; active = []; if(matched === 6) nextLevel();
                        } else {
                            setTimeout(() => { active.forEach(c => c.classList.remove('flipped')); active = []; }, 500);
                        }
                    }
                }
            }; grid.appendChild(d);
        });
    }

    function updateHearts() { document.getElementById('heart-bar').innerText = "‚ù§Ô∏è".repeat(state.hearts); if(state.hearts <= 0) { alert("Our love is stronger than a Game Over! ‚ù§Ô∏è"); state.hearts = 5; updateHearts(); } }
    function openLetter() { document.getElementById('letter-overlay').style.display = 'flex'; }
    function closeLetter() { document.getElementById('letter-overlay').style.display = 'none'; }
    function showFinal() { document.getElementById('scr-final').classList.remove('hidden'); document.getElementById('ui-layer').style.display = 'none'; }
</script>
</body>
</html>
