<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&family=Quicksand:wght@500;700&display=swap');

        :root {
            --pink: #ffc1cc; --hot-pink: #ff4d6d; --cream: #fff5f5; --berry: #5d2e0c;
            --btn-shadow: #e63958;
        }

        * { touch-action: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #1a0508; font-family: 'Quicksand', sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        #game-container { 
            width: 100vw; height: 100vh; max-width: 450px; max-height: 850px; 
            background: var(--cream); position: relative; overflow: hidden; 
            border: 4px solid white; box-shadow: 0 0 50px rgba(255, 77, 109, 0.4); 
        }

        /* Screen Transitions - Squash & Stretch "Juice" */
        .screen { 
            position: absolute; inset: 0; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; text-align: center; 
            padding: 20px; z-index: 10; background: var(--cream);
            animation: inflate 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes inflate {
            0% { transform: scale(0.8) translateY(20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        .hidden { display: none !important; }

        /* Typography */
        h1 { font-family: 'Silkscreen'; color: var(--hot-pink); font-size: 24px; margin: 0; }
        .bob { display: inline-block; animation: bob 0.6s ease-in-out infinite alternate; }
        @keyframes bob { from { transform: translateY(0); } to { transform: translateY(-10px); } }

        /* 3D Tactile Buttons */
        .btn { 
            background: var(--hot-pink); color: white; border: none; 
            padding: 12px 24px; border-radius: 15px; font-family: 'Silkscreen'; 
            font-size: 11px; box-shadow: 0 8px 0 var(--btn-shadow); 
            cursor: pointer; transition: 0.1s; position: relative; margin: 5px;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 4px 0 var(--btn-shadow); }

        /* Loading UI */
        .pulse-berry { font-size: 60px; animation: heartBeat 1.2s infinite; }
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            15% { transform: scale(1.2); }
            30% { transform: scale(1.1); }
            45% { transform: scale(1.25); }
        }
        #bar-outer { width: 80%; height: 22px; background: #331111; border-radius: 11px; border: 3px solid white; overflow: hidden; margin: 20px 0; }
        #bar-inner { width: 0%; height: 100%; background: var(--hot-pink); border-right: 3px solid white; }
        #percent-text { font-family: 'Silkscreen'; color: var(--hot-pink); font-size: 14px; margin-top: -10px; }

        /* Game UI */
        #stats-bar { position: absolute; top: 20px; width: 100%; display: none; justify-content: space-around; z-index: 100; font-family: 'Silkscreen'; color: var(--hot-pink); }
        #ready-overlay { position: absolute; inset: 0; background: rgba(255, 245, 245, 0.98); z-index: 500; display: none; flex-direction: column; align-items: center; justify-content: center; }
        
        /* Obby Physics */
        #photo-frame { width: 130px; height: 130px; border-radius: 50%; border: 6px solid var(--hot-pink); background: #ffe4e9; margin: 15px; display: flex; align-items: center; justify-content: center; font-size: 40px; }
        canvas { display: none; background: #fffaf0; width: 100%; height: 100%; }

        /* Marquee */
        .marquee { background: #ffeff2; padding: 10px; font-family: 'Silkscreen'; font-size: 11px; overflow: hidden; white-space: nowrap; width: 100%; margin-top: 15px; }
        .marquee-inner { display: inline-block; animation: scroll 12s linear infinite; color: var(--hot-pink); }
        @keyframes scroll { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        .confetti { position: absolute; pointer-events: none; animation: drop 2s forwards; z-index: 1000; }
        @keyframes drop { to { transform: translateY(800px) rotate(360deg); opacity: 0; } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="yt-player" style="position:absolute; top:-1000px;"></div>

    <div id="scr-load" class="screen">
        <div class="pulse-berry">üçì</div>
        <h2>SYNCING HEARTS...</h2>
        <div id="bar-outer"><div id="bar-inner"></div></div>
        <div id="percent-text">0%</div>
        <div id="trivia-box" style="height: 60px; padding: 0 25px; font-weight: 800; color: var(--berry); font-size: 13px;">Preparing...</div>
    </div>

    <div id="scr-title" class="screen hidden">
        <h1 id="title-text"></h1>
        <div id="photo-frame">‚ú®</div>
        <p>FOR MY GIRL, LEXI</p>
        <button class="btn" onclick="startGate()">ENTER THE PATCH ‚ú®</button>
    </div>

    <div id="scr-gate1" class="screen hidden">
        <h2>DO YOU LOVE ME?</h2>
        <div style="display: flex; gap: 20px; margin-top: 20px;">
            <button class="btn" style="padding: 20px 40px;" onclick="startGate2()">YES</button>
            <button class="btn" style="padding: 20px 40px;" onclick="startGate2()">YES</button>
        </div>
    </div>

    <div id="scr-gate2" class="screen hidden">
        <h2>DO YOU REALLY LOVE ME?</h2>
        <div id="gate2-area" style="width:100%; height:300px; position:relative; margin-top:20px;">
            <button id="yes-grow" class="btn" style="position:absolute; top:20%; left:50%; transform:translateX(-50%);" onclick="startStage('quiz')">YES! ‚ú®</button>
            <button id="no-run" class="btn" style="position:absolute; top:60%; left:50%; transform:translateX(-50%); background:#555; box-shadow: 0 8px 0 #333;">NO</button>
        </div>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h2 id="quiz-count" style="font-size: 12px; opacity: 0.6;">STAGE: SYNC</h2>
        <p id="quiz-q" style="min-height: 60px; font-size: 16px; margin: 15px 0;"></p>
        <div id="quiz-options" style="display:flex; flex-direction:column; align-items:center; gap:8px; width:100%;"></div>
    </div>

    <div id="ready-overlay">
        <h2 id="ready-title">LEVEL START</h2>
        <p id="ready-instr" style="padding: 20px; font-weight: bold;"></p>
        <div id="count-num">3</div>
    </div>

    <div id="stats-bar"><span id="lives-ui">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span><span id="timer-ui">45s</span></div>
    <canvas id="gameCanvas"></canvas>

    <div id="scr-puzzle" class="screen hidden">
        <h2>WORD SNAP üß©</h2>
        <p>Correctly snap the letters!</p>
        <div id="puzzle-grid" style="display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin-top:20px;"></div>
    </div>

    <div id="scr-bottle" class="screen hidden">
        <h2>RUB TO POP! üçæ</h2>
        <div id="bottle" style="font-size: 100px; cursor: pointer; transition: transform 0.1s;">üçæ</div>
        <div id="bar-outer" style="height:15px;"><div id="rub-progress" style="width:0%; height:100%; background:var(--hot-pink);"></div></div>
    </div>

    <div id="scr-final" class="screen hidden" style="background:var(--pink)">
        <div style="background:white; padding:20px; border-radius:10px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); width: 85%;">
            <div style="width:100%; aspect-ratio:1; background:#ffeef0; display:flex; align-items:center; justify-content:center; font-size:60px;">üçì</div>
            <h2 style="margin-top:15px;">VIBE CHECK: PASSED ‚úÖ</h2>
            <div class="marquee"><div class="marquee-inner">I LOVE YOU LEXI! YOU ARE MY FAVORITE MULTIVERSE. FOREVER YOURS, CJ. üçì</div></div>
        </div>
        <button class="btn" style="margin-top:25px;" onclick="location.reload()">PLAY AGAIN ‚ù§Ô∏è</button>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    const triviaList = [
        "LDR Love Language: FaceTiming until we fall asleep. üí§",
        "Who yaps more? Definitely one of us. üé§",
        "Time zones can't keep us apart! ‚è∞",
        "CJ + Lexi = The Ultimate Duo. üçì",
        "Syncing braincells in 3... 2... 1...",
        "Did you know CJ loves you more than iced coffee?",
        "Distance is just a number, but you are my only #1."
    ];

    const quizData = [
        {q: "What‚Äôs our official LDR love language?", a: ["Virtual movie marathons", "Sending TikToks", "Phone sleepovers", "Yapp sessions", "All of the above"]},
        {q: "Who yaps more during calls?", a: ["CJ", "Lexi", "Both fight", "The Dog"]},
        {q: "Ideal stay-home date?", a: ["Gaming", "Cooking", "Cuddling", "All!"]},
        {q: "Who is the 'Princess'?", a: ["Me", "You", "Rotate", "Both"]},
        {q: "Who is more likely to cry at a movie?", a: ["CJ", "Lexi", "Both together", "Neither"]},
        {q: "Our favorite way to spend $0?", a: ["Deep talks", "Staring at each other", "Window shopping", "All of these"]},
        {q: "Who is the 'Morning Person'?", a: ["Me", "You", "Neither (Zombies)", "Both"]},
        {q: "First thing we do when we meet?", a: ["Big hug", "Cry", "Eat", "All of it!"]},
        {q: "Best memory so far?", a: ["First call", "First photo", "First I love you", "Every moment & lablab"]},
        {q: "Final check: Lexi + CJ?", a: ["Forever", "Endgame", "Infinite", "Yes!"]}
    ];

    let state = { stage: 'load', qIdx: 0, lives: 3, timer: 45, score: 0, items: [], rub: 0, pX: 225, pY: 700, dy: 0, jumping: false, speed: 5, invinc: 0 };
    let ytPlayer, gameInterval;

    function onYouTubeIframeAPIReady() {
        ytPlayer = new YT.Player('yt-player', { videoId: 'Uj93hicGDNc', events: { onReady: boot } });
    }

    function boot() {
        let p = 0;
        const interval = setInterval(() => {
            p++;
            document.getElementById('bar-inner').style.width = p + "%";
            document.getElementById('percent-text').innerText = p + "%";
            if(p % 14 === 0) {
                document.getElementById('trivia-box').innerText = triviaList[Math.floor(p/14) % triviaList.length];
                // Sparkle Effect logic (Visual)
                document.getElementById('trivia-box').style.transform = "scale(1.1)";
                setTimeout(() => document.getElementById('trivia-box').style.transform = "scale(1)", 100);
            }
            if(p >= 100) { clearInterval(interval); startStage('title'); }
        }, 60);
    }

    function startStage(s) {
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        const target = document.getElementById('scr-' + s);
        if(target) target.classList.remove('hidden');

        if(s === 'title') {
            const h1 = document.getElementById('title-text');
            "STRAWBERRY MULTIVERSE".split('').forEach((char, i) => {
                const span = document.createElement('span');
                span.className = 'bob';
                span.innerText = char === ' ' ? '\u00A0' : char;
                span.style.animationDelay = (i * 0.05) + "s";
                h1.appendChild(span);
            });
        }
        if(s === 'quiz') renderQuiz();
    }

    function startGate() { ytPlayer.playVideo(); startStage('gate1'); }
    
    function startGate2() {
        startStage('gate2');
        const yes = document.getElementById('yes-grow');
        const no = document.getElementById('no-run');
        const growInt = setInterval(() => {
            let curScale = parseFloat(yes.style.transform.replace('scale(', '')) || 1;
            yes.style.transform = `translateX(-50%) scale(${curScale + 0.05})`;
        }, 1000);

        no.onmouseover = no.ontouchstart = (e) => {
            e.preventDefault();
            no.style.left = Math.random() * 80 + "%";
            no.style.top = Math.random() * 80 + "%";
        };
    }

    function renderQuiz() {
        if(state.qIdx >= quizData.length) {
            triggerConfetti();
            setTimeout(() => startMiniGame('harvest'), 1500);
            return;
        }
        const data = quizData[state.qIdx];
        document.getElementById('quiz-count').innerText = `SYNCING: ${state.qIdx + 1}/10`;
        document.getElementById('quiz-q').innerText = data.q;
        const container = document.getElementById('quiz-options');
        container.innerHTML = '';
        data.a.forEach(opt => {
            const b = document.createElement('button');
            b.className = 'btn'; b.innerText = opt;
            b.onclick = () => {
                state.qIdx++;
                renderQuiz();
            };
            container.appendChild(b);
        });
    }

    function startMiniGame(type) {
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        const overlay = document.getElementById('ready-overlay');
        const title = document.getElementById('ready-title');
        const instr = document.getElementById('ready-instr');
        const count = document.getElementById('count-num');
        
        overlay.style.display = 'flex';
        if(type === 'harvest') {
            title.innerText = "LEVEL 2: THE HARVEST";
            instr.innerText = "Drag the Berry! Collect 10 Hearts. Avoid the VIBES! üëæ";
        } else {
            title.innerText = "LEVEL 3: THE LEAP";
            instr.innerText = "Tap to JUMP! Don't let the distance catch you! üß∫";
        }

        let c = 3; count.innerText = c;
        const cd = setInterval(() => {
            c--; count.innerText = c;
            if(c <= 0) {
                clearInterval(cd); overlay.style.display = 'none';
                if(type === 'harvest') initHarvest(); else initObby();
            }
        }, 1000);
    }

    function initHarvest() {
        state.stage = 'harvest';
        document.getElementById('gameCanvas').style.display = 'block';
        document.getElementById('stats-bar').style.display = 'flex';
        state.score = 0; state.timer = 45; state.items = [];
        gameInterval = setInterval(() => {
            state.timer--;
            document.getElementById('timer-ui').innerText = state.timer + "s";
            if(state.timer <= 0) startMiniGame('obby');
        }, 1000);
        runEngine();
    }

    function initObby() {
        clearInterval(gameInterval);
        state.stage = 'obby';
        state.score = 0; state.speed = 5; state.items = [];
        setInterval(() => { if(state.stage === 'obby') state.speed *= 1.1; }, 5000);
    }

    function runEngine() {
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 450; canvas.height = 850;
        ctx.clearRect(0,0,450,850);
        document.getElementById('lives-ui').innerText = "‚ù§Ô∏è".repeat(state.lives);

        if(state.stage === 'harvest') {
            if(Math.random() < 0.05) state.items.push({x: Math.random()*400, y: -50, t: Math.random()>0.3?'üíñ':'üëæ'});
            state.items.forEach((it, i) => {
                it.y += 5; ctx.font = "40px Arial"; ctx.fillText(it.t, it.x, it.y);
                if(Math.hypot(it.x - state.pX, it.y - state.pY) < 50 && state.invinc <= 0) {
                    if(it.t === 'üíñ') state.score++; else { state.lives--; state.invinc = 120; }
                    state.items.splice(i, 1);
                }
            });
            if(state.invinc > 0) { state.invinc--; ctx.globalAlpha = 0.5; }
            ctx.font = "50px Arial"; ctx.fillText("üçì", state.pX-25, state.pY+25);
            ctx.globalAlpha = 1;
            if(state.score >= 10) startMiniGame('obby');
        }

        if(state.stage === 'obby') {
            state.dy += 0.8; state.pY += state.dy;
            let ground = 700;
            if(state.pY > ground) { 
                if(state.pY !== ground) { /* Juicy Squash */ }
                state.pY = ground; state.dy = 0; state.jumping = false; 
            }
            if(Math.random() < 0.02) state.items.push({x: 500, y: 700, t: 'üöß'});
            state.items.forEach((it, i) => {
                it.x -= state.speed; ctx.font = "40px Arial"; ctx.fillText(it.t, it.x, it.y);
                if(it.x < 80 && it.x > 20 && state.pY > 650) { state.lives--; state.items.splice(i,1); }
            });
            ctx.fillText("üß∫", 40, state.pY+20);
            state.score++;
            if(state.score > 500) startPuzzle();
        }

        if(state.lives <= 0) location.reload();
        if(state.stage !== 'puzzle') requestAnimationFrame(runEngine);
    }

    function startPuzzle() {
        state.stage = 'puzzle';
        document.getElementById('gameCanvas').style.display = 'none';
        document.getElementById('stats-bar').style.display = 'none';
        startStage('puzzle');
        const grid = document.getElementById('puzzle-grid');
        "ILOVEYOU".split('').forEach(l => {
            const t = document.createElement('div');
            t.className = 'btn'; t.style.fontSize = "20px"; t.innerText = l;
            t.onclick = () => { 
                t.style.background = "#4CAF50"; 
                if([...grid.children].every(c => c.style.background.includes('rgb(76'))) startBottle();
            };
            grid.appendChild(t);
        });
    }

    function startBottle() {
        startStage('bottle');
        const b = document.getElementById('bottle');
        b.onmousemove = b.ontouchmove = (e) => {
            e.preventDefault();
            state.rub += 1;
            document.getElementById('rub-progress').style.width = state.rub + "%";
            b.style.transform = `rotate(${Math.sin(state.rub)*10}deg) scale(${1 + state.rub/200})`;
            if(state.rub >= 100) startStage('final');
        };
    }

    function triggerConfetti() {
        for(let i=0; i<30; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.innerText = '‚ù§Ô∏è';
            c.style.left = Math.random() * 100 + "vw";
            c.style.fontSize = (Math.random() * 20 + 10) + "px";
            document.body.appendChild(c);
            setTimeout(() => c.remove(), 2000);
        }
    }

    window.onmousemove = window.ontouchmove = (e) => {
        const x = e.touches ? e.touches[0].clientX : e.clientX;
        state.pX = x - (window.innerWidth - 450)/2;
        if(state.stage === 'obby' && !state.jumping) { state.dy = -18; state.jumping = true; }
    };
</script>
</body>
</html>
