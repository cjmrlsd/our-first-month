<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        :root {
            --pink: #ffb7c5;
            --hot-pink: #ff4d6d;
            --cream: #fff5f5;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: var(--pink);
            font-family: 'Press Start 2P', cursive;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        #game-container {
            width: 375px; height: 667px;
            background: var(--cream);
            border: 6px solid white;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        /* UI / Hearts */
        #ui-layer {
            position: absolute; top: 15px; left: 15px; right: 15px;
            z-index: 100; display: none; justify-content: space-between;
            pointer-events: none;
        }
        #heart-bar { color: var(--hot-pink); font-size: 10px; }

        /* Screens */
        .screen {
            position: absolute; width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box;
            background: var(--cream);
        }
        .hidden { display: none !important; }

        .instruction-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98);
            z-index: 200; display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 30px;
            text-align: center; box-sizing: border-box;
        }

        h1 { font-size: 16px; color: var(--hot-pink); margin-bottom: 20px; }
        p { font-size: 10px; color: #555; line-height: 1.8; }

        .btn {
            background: var(--hot-pink); color: white;
            border: none; padding: 15px; border-radius: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px; cursor: pointer; margin: 10px;
            box-shadow: 0 4px 0 #c9184a;
            z-index: 10;
        }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #c9184a; }

        /* FIXED: Added absolute positioning and initial placement */
        #no-btn { 
            position: absolute; 
            top: 60%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            transition: 0.2s ease;
            white-space: nowrap;
            z-index: 50; 
        }

        canvas { display: none; width: 100%; height: 100%; background: #fff0f3; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui-layer">
        <div id="heart-bar"></div>
        <div id="lvl-display" style="font-size: 8px;">LVL: 1</div>
    </div>

    <div id="instruction-screen" class="instruction-overlay hidden">
        <h2 id="ins-title" style="color: var(--hot-pink); font-size: 14px;"></h2>
        <p id="ins-text"></p>
        <button class="btn" onclick="startLevelAfterInstructions()">START LEVEL</button>
    </div>

    <div id="scr-intro" class="screen">
        <div style="font-size: 40px;">üçì</div>
        <h1>Strawberry Multiverse</h1>
        <button class="btn" onclick="goToStep(1)">START ADVENTURE</button>
    </div>

    <div id="scr-love1" class="screen hidden">
        <h1>Do you love me?</h1>
        <button class="btn" onclick="goToStep(2)">YES</button>
        <button class="btn" onclick="goToStep(2)">YES</button>
    </div>

    <div id="scr-love2" class="screen hidden">
        <h1>Do you REALLY love me?</h1>
        <div style="height: 100px; width: 100%; position: relative;">
            <button class="btn" onclick="nextLevel()" style="position: absolute; top: 0; left: 50%; transform: translateX(-110%);">YES</button>
            <button class="btn" id="no-btn" onmouseover="dodge()" ontouchstart="dodge()">NO</button>
        </div>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h1 id="q-num">Q1</h1>
        <p id="q-text" style="margin-bottom:20px;"></p>
        <div id="quiz-options"></div>
    </div>

    <canvas id="mainCanvas"></canvas>

    <div id="scr-final" class="screen hidden">
        <h1>Happy 1st Month!</h1>
        <div style="background:white; padding:10px; border:2px solid #eee; margin:10px;">
            <div style="width:200px; height:200px; background:#ffd1dc; display:flex; align-items:center; justify-content:center;">üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©</div>
        </div>
        <p>You cleared all levels!</p>
        <div id="timer" style="font-size: 12px; color: var(--hot-pink); margin-top:10px;"></div>
    </div>
</div>

<script>
    const state = {
        level: 0,
        hearts: 10,
        quizIndex: 0,
        isPaused: true,
        coins: 0
    };

    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 375;
    canvas.height = 667;

    const levelInstructions = {
        1: { title: "LEVEL 1: Connection Quiz", text: "Answer honestly! 10 questions to test our digital chemistry. Click the answer that fits us best!" },
        2: { title: "LEVEL 2: Space Impact", text: "Distance is the enemy! Drag to move the Strawberry Ship. Tap/Click to shoot SEEDS at the Clocks and Flags. Collect COINS!" }
    };

    // FIXED DODGE FUNCTION
    function dodge() {
        const btn = document.getElementById('no-btn');
        // Calculate random positions within the game container
        const maxX = 375 - btn.offsetWidth;
        const maxY = 667 - btn.offsetHeight;
        
        const randomX = Math.floor(Math.random() * maxX);
        const randomY = Math.floor(Math.random() * maxY);

        // Remove the initial centering transform and use raw coordinates
        btn.style.transform = 'none';
        btn.style.left = randomX + 'px';
        btn.style.top = randomY + 'px';
    }

    function goToStep(s) {
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        if(s===1) document.getElementById('scr-love1').classList.remove('hidden');
        if(s===2) document.getElementById('scr-love2').classList.remove('hidden');
    }

    function nextLevel() {
        state.level++;
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        document.getElementById('ui-layer').style.display = 'flex';
        document.getElementById('lvl-display').innerText = "LVL: " + state.level;
        updateHearts();
        
        const ins = levelInstructions[state.level];
        if (ins) {
            document.getElementById('ins-title').innerText = ins.title;
            document.getElementById('ins-text').innerText = ins.text;
            document.getElementById('instruction-screen').classList.remove('hidden');
        } else {
            showFinal();
        }
    }

    function startLevelAfterInstructions() {
        document.getElementById('instruction-screen').classList.add('hidden');
        state.isPaused = false;
        if(state.level === 1) startQuiz();
        if(state.level === 2) startSpaceImpact();
    }

    function updateHearts() {
        document.getElementById('heart-bar').innerText = "‚ù§Ô∏è".repeat(state.hearts);
    }

    // --- LEVEL 1 QUIZ ---
    const quizData = [
        { q: "Who yaps more on the phone?", a: ["Me", "You"] },
        { q: "Who is the most likely to fall asleep on video calls?", a: ["Me", "You"] },
        { q: "Who is the 'softest' for the other?", a: ["Me", "You"] },
        { q: "Who is the morning person?", a: ["Me", "You"] },
        { q: "Who is more clingy (in a cute way)?", a: ["Me", "You"] },
        { q: "Our favorite way to spend a digital date?", a: ["Movies","Gaming","Yap","All of the above"] },
        { q: "Who fell first?", a: ["Me", "You"] },
        { q: "Who is the biggest overthinker?", a: ["Me", "You"] },
        { q: "Who sends more 'I love you' texts?", a: ["Me", "You"] },
        { q: "Ready to fight distance?", a: ["YES", "YES!"] }
    ];

    function startQuiz() {
        document.getElementById('scr-quiz').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        const data = quizData[state.quizIndex];
        document.getElementById('q-num').innerText = "Q" + (state.quizIndex + 1);
        document.getElementById('q-text').innerText = data.q;
        const options = document.getElementById('quiz-options');
        options.innerHTML = '';
        data.a.forEach(choice => {
            const b = document.createElement('button');
            b.className = 'btn'; b.innerText = choice;
            b.onclick = () => {
                state.quizIndex++;
                if(state.quizIndex < quizData.length) showQuestion();
                else nextLevel();
            };
            options.appendChild(b);
        });
    }

    // --- LEVEL 2 SPACE IMPACT ---
    let ship = { x: 50, y: 330 };
    let seeds = [];
    let enemies = [];
    let coins = [];
    let frames = 0;

    canvas.addEventListener('mousedown', () => { if(state.level === 2) seeds.push({x: ship.x+20, y: ship.y}); });
    canvas.addEventListener('mousemove', (e) => { 
        const rect = canvas.getBoundingClientRect();
        ship.y = e.clientY - rect.top; 
    });

    function startSpaceImpact() {
        canvas.style.display = 'block';
        function loop() {
            if(state.level !== 2 || state.isPaused) return;
            ctx.clearRect(0,0,canvas.width, canvas.height);
            
            // Player
            ctx.font = "30px Arial";
            ctx.fillText("üçì", ship.x, ship.y + 10);

            // Seeds
            seeds.forEach((s, i) => {
                s.x += 7; ctx.fillText("üå±", s.x, s.y + 10);
                if(s.x > canvas.width) seeds.splice(i,1);
            });

            // Enemies
            if(frames % 60 === 0) enemies.push({x: 400, y: Math.random()*600, t: Math.random()>0.5?"‚è∞":"üö©"});
            enemies.forEach((en, i) => {
                en.x -= 3; ctx.fillText(en.t, en.x, en.y);
                seeds.forEach((sd, si) => {
                    if(Math.abs(sd.x - en.x) < 30 && Math.abs(sd.y - en.y) < 30) {
                        enemies.splice(i,1); seeds.splice(si,1);
                    }
                });
                if(en.x < 80 && en.x > 30 && Math.abs(en.y - ship.y) < 30) {
                    state.hearts--; updateHearts(); enemies.splice(i,1);
                }
            });

            frames++;
            if(frames > 800) { canvas.style.display='none'; nextLevel(); return; }
            requestAnimationFrame(loop);
        }
        loop();
    }

    function showFinal() {
        document.getElementById('scr-final').classList.remove('hidden');
        document.getElementById('ui-layer').style.display = 'none';
        const nextMonth = new Date(); nextMonth.setMonth(nextMonth.getMonth()+1);
        setInterval(() => {
            const diff = nextMonth - new Date();
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            document.getElementById('timer').innerText = `${d}d ${h}h ${m}m To Next Month`;
        }, 1000);
    }
</script>
</body>
</html>
