<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Silkscreen:wght@400;700&family=Quicksand:wght@500;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-pink: #ffafbd; --accent-red: #ff6b81; --deep-berry: #d81b60;
            --bg-gradient: linear-gradient(180deg, #e3f2fd 0%, #fce4ec 100%);
            --surface-white: rgba(255, 255, 255, 0.9); --scroll-paper: #fffcf5;
            --text-dark: #333333; --text-pixel: #5d4037; --border-soft: 6px solid white; --gold: #ffd700;
        }
        * { touch-action: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #1a0508; font-family: 'Quicksand', sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; }
        
        #game-container { 
            width: 100vw; height: 100vh; max-width: 450px; 
            background: var(--bg-gradient); 
            position: relative; border: var(--border-soft); 
            overflow: hidden; border-radius: 25px; 
            box-shadow: 0 15px 50px rgba(0,0,0,0.1); 
        }

        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; z-index: 10; }
        .hidden { display: none !important; }

        /* Buttons */
        .btn { 
            background: var(--deep-berry); color: white; border: none; 
            padding: 12px 20px; border-radius: 15px; font-family: 'Silkscreen'; 
            font-size: 11px; box-shadow: 0 6px 0 #ad1457; cursor: pointer; margin: 5px; 
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 2px 0 #ad1457; }
        .tight-btn { width: auto !important; padding: 10px 25px !important; display: inline-block; }

        /* Loader */
        #load-bar-container { width: 80%; height: 22px; background: var(--surface-white); border-radius: 12px; border: 3px solid var(--text-pixel); overflow: hidden; margin: 20px 0; }
        #load-bar-fill { width: 0%; height: 100%; background: var(--accent-red); transition: width 0.1s linear; }

        /* Victory Overlay */
        #victory-overlay { 
            position: absolute; inset: 0; z-index: 2000; 
            background: rgba(255, 255, 255, 0.9); 
            display: none; flex-direction: column; align-items: center; justify-content: center; 
        }
        .victory-text { font-family: 'Fredoka One'; color: var(--accent-red); font-size: 32px; animation: bounce 0.5s infinite alternate; }

        @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.1); } }

        /* Memory Snap */
        #memory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 90%; max-width: 320px; }
        .card { aspect-ratio: 1/1; background: var(--primary-pink); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; color: transparent; border: 3px solid white; box-shadow: 0 4px 0 #ad1457; transition: 0.3s; }
        .card.flipped { background: white; color: initial; transform: rotateY(180deg); }
        .card.matched { background: #e0ffe0; border-color: #90ee90; box-shadow: none; }

        /* Final Scroll */
        #final-scroll { display: none; position: absolute; inset: 0; z-index: 1000; background: var(--scroll-paper); padding: 40px 25px; overflow-y: auto; border: 10px solid #fce4ec; transform: scale(0); transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #final-scroll.open { display: block; transform: scale(1); }
        #letter { text-align: left; font-size: 10px; line-height: 1.8; color: var(--text-dark); font-family: 'Press Start 2P', cursive; }
        
        canvas { background: transparent; width: 100%; height: 100%; display: none; object-fit: contain; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="stats-bar" style="position: absolute; top: 20px; width: 100%; display: none; justify-content: space-around; z-index: 100; font-family: 'Silkscreen'; color: var(--deep-berry);"><div id="lives-ui">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div></div>

    <div id="music-player" style="position: absolute; width: 1px; height: 1px; opacity: 0; pointer-events: none;"></div>

    <div id="victory-overlay">
        <div class="victory-text">LEVEL CLEAR! ‚ú®</div>
        <p style="font-family: 'Silkscreen'; font-size: 10px; margin-top: 10px;">PROCEEDING TO NEXT LEVEL...</p>
    </div>

    <div id="scr-load" class="screen">
        <div style="font-size:65px; animation: pulse 1s infinite;">üçì</div>
        <div id="percent-text" style="font-family:'Silkscreen'; color: var(--text-pixel);">0%</div>
        <div id="load-bar-container"><div id="load-bar-fill"></div></div>
        <div id="trivia-box" style="height:60px; font-size:13px; font-weight:bold; color: var(--text-pixel); font-family: 'Fredoka One';">Syncing Hearts...</div>
    </div>

    <div id="scr-title" class="screen hidden">
        <h1 style="font-family:'Fredoka One'; color: var(--accent-red); font-size: 28px;">STRAWBERRY MULTIVERSE</h1>
        <button class="btn tight-btn" onclick="startAdventureWithMusic()">START ADVENTURE ‚ú®</button>
    </div>

    <div id="scr-gate1" class="screen hidden"><h2>DO YOU LOVE ME?</h2><div style="display:flex; gap:10px;"><button class="btn tight-btn" onclick="showScreen('scr-gate2')">YES</button><button class="btn tight-btn" onclick="showScreen('scr-gate2')">YES</button></div></div>
    <div id="scr-gate2" class="screen hidden"><h2>DO YOU REALLY LOVE ME?</h2><div id="gate-area-logic" style="width:100%; height:300px; position:relative; display:flex; gap:10px; align-items:center; justify-content:center;"><button id="yes-btn-3" class="btn tight-btn" onclick="handleYesSequence()">YES!</button><button id="no-run" class="btn tight-btn" onmouseover="teleportNo()" ontouchstart="teleportNo()" onclick="handleNoClick()">NO</button></div></div>

    <div id="scr-quiz" class="screen hidden"><h2 id="quiz-count" style="font-size:11px; color:var(--deep-berry); font-family:'Silkscreen';">SYNCING...</h2><p id="quiz-q" style="min-height:50px; font-weight:bold; font-size:16px; font-family: 'Fredoka One';"></p><div id="quiz-options" style="display:flex; flex-direction:column; align-items:center; width:100%; gap:8px;"></div></div>

    <div id="scr-memory" class="screen hidden"><h2 style="font-family:'Fredoka One'; color: var(--accent-red);">‚ú® HEART SNAP ‚ú®</h2><div id="matches-text" style="font-family:'Silkscreen'; margin-bottom: 10px;">Matches: 0 / 6</div><div id="memory-grid"></div></div>

    <div id="scr-boss" class="screen hidden" style="padding:0;">
        <div id="boss-tag" style="position: absolute; top: 75px; width: 100%; display: none; flex-direction: column; align-items: center; z-index: 100;"><div class="boss-name" id="boss-label">VILLAIN</div><div class="hp-container"><div class="hp-fill" id="hp-fill"></div></div></div>
        <div id="bubble" class="dialog-bubble"></div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="final-scroll">
        <div class="scroll-title" style="color: var(--accent-red); font-family: 'Fredoka One'; text-align: center; margin-bottom: 20px; font-size: 24px;">üìú Victory for Lexi & CJ</div>
        <div id="letter"></div>
        <center><div style="font-size: 30px; margin: 20px 0;">üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©</div><button onclick="location.reload()" class="btn tight-btn" style="background: var(--accent-red); border-radius:30px; font-family:'Fredoka One'; font-size: 16px;">Replay Journey</button></center>
    </div>

    <div id="death-screen" style="position: absolute; inset: 0; background: rgba(26, 5, 8, 0.98); z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; color: white;"><h1 style="font-family:'Silkscreen';">YOU DIED</h1><div id="fill-ui"></div><p>BLOW INTO MIC!</p><button class="btn tight-btn" onclick="initMic()">REVIVE</button></div>
    <div id="ready-overlay" class="screen hidden" style="background:rgba(255,245,245,0.98); z-index:1000;"><h2 id="ready-title" style="font-family:'Fredoka One'; color: var(--accent-red);"></h2><p id="ready
