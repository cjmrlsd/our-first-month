<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap');

        :root {
            --pink: #ffb7c5;
            --hot-pink: #ff4d6d;
            --dark-pink: #8a263a;
            --cream: #fff5f5;
        }

        * { touch-action: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #220a0e;
            font-family: 'Silkscreen', cursive;
            overflow: hidden; display: flex; justify-content: center; align-items: center;
        }

        #game-container {
            width: 100%; height: 100%;
            max-width: 450px; max-height: 850px;
            background: var(--cream);
            position: relative; overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 0 20px rgba(138, 38, 58, 0.5);
        }

        /* The Player must be visible but 1px to work on all browsers */
        #youtube-player { 
            position: absolute; top: 0; left: 0; 
            width: 1px; height: 1px; opacity: 0.01; 
        }

        #music-toggle {
            position: absolute; top: 20px; right: 20px;
            z-index: 1000; background: white; border: 2px solid var(--hot-pink);
            border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 20px; box-shadow: 0 4px 0 var(--pink);
        }

        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 20px; z-index: 10;
            background: var(--cream);
        }

        .hidden { display: none !important; }

        .btn {
            background: var(--hot-pink); color: white;
            border: none; padding: 15px 10px; border-radius: 50px;
            font-family: 'Silkscreen', cursive; font-size: 13px;
            cursor: pointer; box-shadow: 0 5px 0 var(--dark-pink);
            margin: 8px 0; width: 90%; transition: 0.1s;
        }

        .btn:disabled { background: #ccc; box-shadow: none; cursor: wait; }

        #no-btn { position: absolute; z-index: 9999; width: auto !important; padding: 10px 20px; background: #ff85a1; }
        canvas { display: none; width: 100%; height: 100%; background: #fff0f3; }
        #letter-overlay {
            position: absolute; inset: 5%; background: #fffafa;
            border: 4px solid var(--hot-pink); border-radius: 20px;
            padding: 20px; z-index: 5000; overflow-y: auto;
            display: none; flex-direction: column;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="youtube-player"></div>
    <div id="music-toggle" onclick="toggleMusic()">üéµ</div>

    <div id="ui-layer" style="position:absolute; top:20px; left:20px; display:none; z-index:100; pointer-events: none;">
        <div id="heart-bar" style="font-size: 20px;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div id="scr-intro" class="screen">
        <div style="font-size: 60px;">üçì</div>
        <h1>STRAWBERRY<br>MULTIVERSE</h1>
        <p id="loading-text" style="font-size: 10px;">Tuning the radio...</p>
        <button id="start-btn" class="btn" onclick="startAdventure()" disabled>LOADING...</button>
    </div>

    <div id="scr-love2" class="screen hidden">
        <h1>DO YOU REALLY<br>LOVE ME?</h1>
        <button class="btn" onclick="nextLevel()">YES!</button>
        <button id="no-btn" class="btn">NO</button>
    </div>

    <div id="instruction-screen" class="screen hidden">
        <h2 id="ins-title"></h2>
        <p id="ins-text"></p>
        <button class="btn" onclick="startActualLvl()">I'M READY!</button>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h2 id="q-num"></h2>
        <p id="q-text"></p>
        <div id="quiz-options"></div>
    </div>

    <canvas id="mainCanvas"></canvas>

    <div id="scr-final" class="screen hidden">
        <h1>VICTORY!</h1>
        <div style="font-size: 60px;">üçì‚ú®</div>
        <button class="btn" onclick="openLetter()">READ MY LETTER üíå</button>
    </div>

    <div id="letter-overlay">
        <h2>Happy 1st Month Aliii! üçì</h2>
        <div style="text-align: left; line-height: 1.6; font-family: sans-serif;">
            Dear Lexi Merindo,<br><br>
            They say the first month is just the beginning, but with you, it feels like I've found my favorite person in the entire multiverse. Even across the distance, every video call makes me fall for you all over again.<br><br>
            I love you more than all the strawberries in the world.<br><br>
            Yours Forever,<br>Cj Morales
        </div>
        <button class="btn" onclick="closeLetter()">CLOSE</button>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    let isMusicReady = false;
    const state = { 
        level: 0, hearts: 5, score: 0, quizIndex: 0, 
        frames: 0, objects: [], isPaused: true,
        player: { x: 200, targetX: 200 }
    };

    // 1. Setup YouTube Player
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-player', {
            height: '1', width: '1',
            videoId: 'Uj93hicGDNc',
            playerVars: { 
                'autoplay': 0, 
                'controls': 0, 
                'loop': 1, 
                'playlist': 'Uj93hicGDNc',
                'origin': window.location.origin 
            },
            events: { 
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange
            }
        });
    }

    function onPlayerReady(event) {
        isMusicReady = true;
        const btn = document.getElementById('start-btn');
        btn.disabled = false;
        btn.innerText = "START ADVENTURE";
        document.getElementById('loading-text').innerText = "Music Ready! üéµ";
    }

    function onPlayerStateChange(event) {
        // Ensure it loops
        if (event.data === YT.PlayerState.ENDED) {
            player.playVideo();
        }
    }

    // 2. Interaction triggers play
    function startAdventure() {
        if (player) {
            player.setVolume(100);
            player.playVideo();
        }
        document.getElementById('scr-intro').classList.add('hidden');
        document.getElementById('scr-love2').classList.remove('hidden');
    }

    function toggleMusic() {
        if (!player) return;
        if (player.getPlayerState() === 1) {
            player.pauseVideo();
            document.getElementById('music-toggle').innerText = "üîá";
        } else {
            player.playVideo();
            document.getElementById('music-toggle').innerText = "üéµ";
        }
    }

    // 3. Game Logic (Simplified for stability)
    function nextLevel() {
        state.level++;
        document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
        document.getElementById('mainCanvas').style.display = 'none';
        state.isPaused = true;

        if(state.level === 3) {
            document.getElementById('scr-final').classList.remove('hidden');
            return;
        }

        const data = [
            null,
            {t: "LVL 1: SYNC", d: "Answer 10 questions to sync our hearts!"},
            {t: "LVL 2: HARVEST", d: "Catch 15 strawberries! Drag to move."}
        ][state.level];

        const ins = document.getElementById('instruction-screen');
        ins.classList.remove('hidden');
        document.getElementById('ins-title').innerText = data.t;
        document.getElementById('ins-text').innerText = data.d;
    }

    function startActualLvl() {
        document.getElementById('instruction-screen').classList.add('hidden');
        document.getElementById('ui-layer').style.display = 'block';
        state.isPaused = false;
        if (state.level === 1) startQuiz();
        else {
            document.getElementById('mainCanvas').style.display = 'block';
            runGameLoop();
        }
    }

    function startQuiz() {
        const scr = document.getElementById('scr-quiz');
        scr.classList.remove('hidden');
        const quizData = [
            { q: "Airport Hug Crier?", options: ["Me", "You", "Both"] },
            { q: "Biggest Yapper?", options: ["You", "Me", "Both"] },
            { q: "Ready to be mine?", options: ["Yes!", "Yes (No cap)", "Endgame"] }
            // Add more here if needed!
        ];

        const currentQ = quizData[state.quizIndex] || quizData[quizData.length-1];
        document.getElementById('q-num').innerText = `Q${state.quizIndex + 1}`;
        document.getElementById('q-text').innerText = currentQ.q;
        const optContainer = document.getElementById('quiz-options');
        optContainer.innerHTML = '';

        currentQ.options.forEach(opt => {
            const b = document.createElement('button');
            b.className = 'btn';
            b.innerText = opt;
            b.onclick = () => {
                state.quizIndex++;
                if (state.quizIndex < quizData.length) startQuiz();
                else nextLevel();
            };
            optContainer.appendChild(b);
        });
    }

    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    function runGameLoop() {
        if(state.isPaused) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        state.player.x += (state.player.targetX - state.player.x) * 0.2;
        
        if(state.frames % 40 === 0) state.objects.push({x: Math.random()*canvas.width, y: -50, t: Math.random()>0.2?'üçì':'üíî'});
        
        state.objects.forEach((o, i) => {
            o.y += 5;
            ctx.font = "30px Arial"; ctx.fillText(o.t, o.x, o.y);
            if(o.y > canvas.height - 100 && Math.abs(o.x - state.player.x) < 40) {
                if(o.t === 'üçì') state.score++;
                else state.hearts--;
                state.objects.splice(i, 1);
                document.getElementById('heart-bar').innerText = "‚ù§Ô∏è".repeat(Math.max(0, state.hearts));
            }
        });
        
        ctx.font = "50px Arial"; ctx.fillText("üß∫", state.player.x - 25, canvas.height - 40);
        state.frames++;
        if(state.score >= 15) nextLevel();
        else requestAnimationFrame(runGameLoop);
    }

    canvas.addEventListener('mousemove', (e) => state.player.targetX = e.clientX - canvas.getBoundingClientRect().left);
    canvas.addEventListener('touchmove', (e) => state.player.targetX = e.touches[0].clientX - canvas.getBoundingClientRect().left);
    
    const noBtn = document.getElementById('no-btn');
    noBtn.addEventListener('mouseover', () => { noBtn.style.left = Math.random()*70+'%'; noBtn.style.top = Math.random()*70+'%'; });

    function openLetter() { document.getElementById('letter-overlay').style.display = 'flex'; }
    function closeLetter() { document.getElementById('letter-overlay').style.display = 'none'; }
    function resize() { canvas.width = 450; canvas.height = 850; }
    resize();
</script>
</body>
</html>
