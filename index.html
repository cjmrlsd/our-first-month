<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&family=Quicksand:wght@500;700&display=swap');

        :root {
            --pink: #ffc1cc; --hot-pink: #ff4d6d; --cream: #fff5f5; --berry: #5d2e0c;
        }

        * { touch-action: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #1a0508; font-family: 'Quicksand', sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        #game-container { 
            width: 100vw; height: 100vh; max-width: 450px; max-height: 850px; 
            background: var(--cream); position: relative; overflow: hidden; 
            border: 4px solid white; box-shadow: 0 0 50px rgba(255, 77, 109, 0.4); 
        }

        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 10px; z-index: 10; background: var(--cream); }
        .hidden { display: none !important; }

        h1, h2 { font-family: 'Silkscreen', cursive; color: var(--hot-pink); text-shadow: 2px 2px 0 white; margin: 4px 0; line-height: 1.1; }
        p { margin: 2px 0; font-size: 13px; color: var(--berry); font-weight: 700; }

        /* Tight UI Button Styles */
        .btn-container { width: 100%; display: flex; flex-direction: column; align-items: center; gap: 6px; margin-top: 8px; }
        .btn { 
            background: linear-gradient(180deg, var(--hot-pink) 0%, #e63958 100%); 
            color: white; border: none; 
            padding: 10px 18px; /* Tighter padding */
            border-radius: 50px; 
            font-family: 'Silkscreen'; font-size: 11px; 
            box-shadow: 0 4px 0 #8a263a; 
            width: fit-content; /* Only as wide as the text */
            min-width: 120px; /* Ensures a clickable base */
            max-width: 85%;
            cursor: pointer; transition: 0.1s; 
        }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #8a263a; }

        /* The specific Runaway No button styling */
        #runaway-no {
            position: absolute;
            padding: 8px 15px;
            min-width: 60px;
            font-size: 10px;
            z-index: 50;
        }

        #stats-bar { position: absolute; top: 15px; width: 100%; display: none; justify-content: space-around; font-family: 'Silkscreen'; color: var(--hot-pink); z-index: 100; pointer-events: none; }
        #bar-outer { width: 70%; height: 16px; background: #331111; border-radius: 10px; border: 2px solid white; overflow: hidden; margin: 10px; }
        #bar-inner { width: 0%; height: 100%; background: var(--hot-pink); }

        canvas { display: none; width: 100%; height: 100%; background: #fffaf0; }

        #puzzle-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; width: 80%; margin-top: 10px; }
        .tile { aspect-ratio: 1; background: white; border: 2px solid var(--pink); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-family: 'Silkscreen'; font-size: 16px; }
        .tile.active { background: var(--hot-pink); color: white; transform: scale(1.05); }

        #polaroid { background: white; padding: 10px 10px 25px 10px; border-radius: 2px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); width: 80%; transform: rotate(-1deg); }
        #marquee-box { background: #ffeff2; padding: 3px; font-family: 'Silkscreen'; font-size: 9px; margin-top: 8px; overflow: hidden; white-space: nowrap; }
        @keyframes scroll { from { transform: translateX(100%); } to { transform: translateX(-100%); } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="yt-player" style="position:absolute; top:-1000px; opacity:0;"></div>
    <div id="stats-bar"><span id="lives-ui">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span><span id="timer-ui">45s</span></div>

    <div id="scr-load" class="screen">
        <div style="font-size: 40px;">üçì</div>
        <h2>SYNCING HEARTS...</h2>
        <div id="trivia-box" style="height: 35px; font-weight: bold; font-size: 11px; padding: 0 15px;"></div>
        <div id="bar-outer"><div id="bar-inner"></div></div>
    </div>

    <div id="scr-title" class="screen hidden">
        <h1>STRAWBERRY MULTIVERSE</h1>
        <div style="width:130px; height:130px; border-radius:50%; border:4px solid var(--hot-pink); overflow:hidden; margin: 8px;">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lexi" style="width:100%">
        </div>
        <p>FOR MY GIRL, LEXI</p>
        <button class="btn" onclick="startStage('gate1')">ENTER THE PATCH ‚ú®</button>
    </div>

    <div id="scr-gate1" class="screen hidden">
        <h2>DO YOU LOVE ME?</h2>
        <div class="btn-container">
            <button class="btn" onclick="startStage('gate2')">YES!</button>
            <button class="btn" onclick="startStage('gate2')">YES!</button>
        </div>
    </div>

    <div id="scr-gate2" class="screen hidden">
        <h2 style="margin-bottom: 20px;">DO YOU REALLY LOVE ME?</h2>
        <div id="runaway-area" style="width:100%; height:300px; position:relative;">
            <button class="btn" onclick="startStage('quiz')" style="position:absolute; top:20%; left:50%; transform:translate(-50%, -50%);">YES! ‚ú®</button>
            <button class="btn" id="runaway-no" style="top:60%; left:50%; transform:translate(-50%, -50%);">NO</button>
        </div>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h2 id="quiz-count" style="font-size: 14px;">THE SYNC: 1/15</h2>
        <p id="quiz-q" style="min-height: 50px; padding: 5px; font-size: 14px;"></p>
        <div id="quiz-options" class="btn-container"></div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="scr-puzzle" class="screen hidden">
        <h2>WORD SNAP üß©</h2>
        <div id="puzzle-grid"></div>
    </div>

    <div id="scr-bottle" class="screen hidden">
        <h2>RUB TO POP! üçæ</h2>
        <div id="bottle" style="font-size: 80px; margin: 15px; cursor: pointer;">üçæ</div>
        <div id="bar-outer" style="height:10px;"><div id="rub-inner" style="width:0%; height:100%; background:var(--hot-pink);"></div></div>
    </div>

    <div id="scr-final" class="screen hidden" style="background:var(--pink)">
        <div id="polaroid">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Couple" style="width:100%; background:#fcfcfc;">
            <h2 style="font-size:12px; margin: 8px 0;">VIBE CHECK: PASSED ‚úÖ</h2>
            <div id="marquee-box"><div style="display:inline-block; animation: scroll 10s linear infinite; color:var(--hot-pink);">I LOVE YOU LEXI! YOU ARE MY FAVORITE MULTIVERSE. FOREVER YOURS, CJ. üçì</div></div>
        </div>
        <button class="btn" style="margin-top:15px;" onclick="location.reload()">PLAY AGAIN ‚ù§Ô∏è</button>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    const quizData = [
        {q: "What‚Äôs our official LDR love language?", a: ["FaceTime marathons", "Sending TikToks", "Phone sleepovers", "All of the above"]},
        {q: "Who yaps more during calls?", a: ["CJ", "Lexi", "Both fight", "The Dog"]},
        {q: "Ideal stay-home date?", a: ["Gaming", "Cooking", "Cuddling", "All!"]},
        {q: "Who is the 'Princess'?", a: ["Me", "You", "Rotate", "Both"]},
        {q: "I love you...", a: ["To the moon", "More than coffee", "Distance Slayer", "Always"]}
    ]; // Add more if needed

    let state = { stage: 'load', qIdx: 0, lives: 3, timer: 45, score: 0, items: [], rub: 0, pX: 225, pY: 700, dy: 0, jumping: false, speed: 5 };
    let player, timerId;
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 450; canvas.height = 850;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-player', { videoId: 'Uj93hicGDNc', events: { onReady: boot } });
    }

    function boot() {
        let p = 0;
        const interval = setInterval(() => {
            p++;
            document.getElementById('bar-inner').style.width = p + "%";
            if(p >= 100) { clearInterval(interval); startStage('title'); }
        }, 30);
    }

    function startStage(s) {
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        canvas.style.display = 'none';
        document.getElementById('stats-bar').style.display = 'none';
        
        if(s === 'title') document.getElementById('scr-title').classList.remove('hidden');
        if(s === 'gate1') { player.playVideo(); document.getElementById('scr-gate1').classList.remove('hidden'); }
        if(s === 'gate2') {
            document.getElementById('scr-gate2').classList.remove('hidden');
            const no = document.getElementById('runaway-no');
            const area = document.getElementById('runaway-area');
            no.onmouseover = no.ontouchstart = () => {
                const maxX = area.clientWidth - no.clientWidth;
                const maxY = area.clientHeight - no.clientHeight;
                no.style.left = Math.random() * maxX + "px";
                no.style.top = Math.random() * maxY + "px";
                no.style.transform = "none"; // Remove initial translate
            };
        }
        if(s === 'quiz') renderQuiz();
    }

    function renderQuiz() {
        if(state.qIdx >= quizData.length) return startHarvest();
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        document.getElementById('scr-quiz').classList.remove('hidden');
        const data = quizData[state.qIdx];
        document.getElementById('quiz-count').innerText = `THE SYNC: ${state.qIdx + 1}/${quizData.length}`;
        document.getElementById('quiz-q').innerText = data.q;
        const container = document.getElementById('quiz-options');
        container.innerHTML = '';
        data.a.forEach(opt => {
            const b = document.createElement('button');
            b.className = 'btn'; b.innerText = opt;
            b.onclick = () => { state.qIdx++; renderQuiz(); };
            container.appendChild(b);
        });
    }

    function startHarvest() {
        state.stage = 'harvest';
        canvas.style.display = 'block';
        document.getElementById('stats-bar').style.display = 'flex';
        timerId = setInterval(() => {
            state.timer--;
            document.getElementById('timer-ui').innerText = state.timer + "s";
            if(state.timer <= 0) startObby();
        }, 1000);
        requestAnimationFrame(update);
    }

    function startObby() { clearInterval(timerId); state.stage = 'obby'; state.score = 0; state.items = []; }

    function update() {
        ctx.clearRect(0,0,450,850);
        document.getElementById('lives-ui').innerText = "‚ù§Ô∏è".repeat(state.lives);
        if(state.stage === 'harvest') {
            if(Math.random() < 0.05) state.items.push({x: Math.random()*400, y: -50, t: Math.random()>0.2?'üíñ':'üëæ'});
            state.items.forEach((it, i) => {
                it.y += 5; ctx.font = "30px Arial"; ctx.fillText(it.t, it.x, it.y);
                if(Math.hypot(it.x - state.pX, it.y - state.pY) < 40) {
                    if(it.t === 'üíñ') state.score++; else state.lives--;
                    state.items.splice(i, 1);
                }
            });
            ctx.fillText("üçì", state.pX-15, state.pY+15);
            if(state.score >= 10) startObby();
        }
        if(state.stage === 'obby') {
            state.dy += 0.8; state.pY += state.dy;
            if(state.pY > 700) { state.pY = 700; state.dy = 0; state.jumping = false; }
            if(Math.random() < 0.03) state.items.push({x: 500, y: 700, t: 'üöß'});
            state.items.forEach((it, i) => {
                it.x -= state.speed; ctx.fillText(it.t, it.x, it.y);
                if(it.x < 60 && it.x > 10 && state.pY > 650) state.lives--;
            });
            ctx.fillText("üß∫", 40, state.pY+20);
            state.score++; if(state.score > 300) startPuzzle();
        }
        if(state.lives <= 0) location.reload();
        if(state.stage !== 'puzzle') requestAnimationFrame(update);
    }

    function startPuzzle() {
        state.stage = 'puzzle';
        document.querySelectorAll('.screen').forEach(scr => scr.classList.add('hidden'));
        document.getElementById('scr-puzzle').classList.remove('hidden');
        canvas.style.display = 'none';
        document.getElementById('stats-bar').style.display = 'none';
        const grid = document.getElementById('puzzle-grid');
        grid.innerHTML = '';
        "ILOVEYOU".split('').forEach(l => {
            const t = document.createElement('div');
            t.className = 'tile'; t.innerText = l;
            t.onclick = () => { t.classList.add('active'); if(document.querySelectorAll('.active').length === 8) {
                document.getElementById('scr-puzzle').classList.add('hidden');
                document.getElementById('scr-bottle').classList.remove('hidden');
                initBottle();
            }};
            grid.appendChild(t);
        });
    }

    function initBottle() {
        const b = document.getElementById('bottle');
        b.onmousemove = b.ontouchmove = () => {
            state.rub += 1.5; document.getElementById('rub-inner').style.width = state.rub + "%";
            if(state.rub >= 100) {
                document.getElementById('scr-bottle').classList.add('hidden');
                document.getElementById('scr-final').classList.remove('hidden');
            }
        };
    }

    window.onmousemove = window.ontouchmove = (e) => {
        const x = e.touches ? e.touches[0].clientX : e.clientX;
        state.pX = x - (window.innerWidth - 450)/2;
        if(state.stage === 'obby' && !state.jumping) { state.dy = -15; state.jumping = true; }
    };
</script>
</body>
</html>
