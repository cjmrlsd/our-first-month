<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&display=swap');

        :root {
            --pink: #ffb7c5;
            --hot-pink: #ff4d6d;
            --dark-pink: #8a263a;
            --cream: #fff5f5;
        }

        /* Prevent all scrolling/bouncing on mobile */
        * { 
            touch-action: none; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            -webkit-user-select: none;
            user-select: none;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: #220a0e;
            font-family: 'Silkscreen', cursive;
            overflow: hidden; display: flex; justify-content: center; align-items: center;
            position: fixed; /* Critical for iOS */
        }

        #game-container {
            width: 100vw; height: 100vh;
            max-width: 450px; max-height: 900px;
            background: var(--cream);
            position: relative; overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 0 20px rgba(138, 38, 58, 0.5);
            color: var(--dark-pink);
        }

        /* YouTube Container - Must be 'visible' but off-screen for iOS background play */
        #youtube-player { 
            position: absolute; top: -100px; left: 0; 
            width: 1px; height: 1px; opacity: 0.01; 
        }

        #music-toggle {
            position: absolute; top: env(safe-area-inset-top, 20px); right: 20px;
            z-index: 1000; background: white; border: 2px solid var(--hot-pink);
            border-radius: 50%; width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 20px; box-shadow: 0 4px 0 var(--pink);
        }

        .screen {
            position: absolute; inset: 0;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 20px; z-index: 10;
            background: var(--cream);
        }

        .hidden { display: none !important; }

        .btn {
            background: var(--hot-pink); color: white;
            border: none; padding: 16px; border-radius: 50px;
            font-family: 'Silkscreen', cursive; font-size: 14px;
            cursor: pointer; box-shadow: 0 5px 0 var(--dark-pink);
            margin: 10px 0; width: 85%; transition: 0.1s;
        }

        .btn:active { transform: translateY(3px); box-shadow: 0 2px 0 var(--dark-pink); }
        .btn:disabled { background: #ccc; box-shadow: none; opacity: 0.6; }

        #no-btn { position: absolute; z-index: 9999; width: auto !important; padding: 10px 20px; background: #ff85a1; }

        canvas { display: none; width: 100%; height: 100%; background: #fff0f3; }

        #letter-overlay {
            position: absolute; inset: 0; background: #fffafa;
            padding: 40px 20px; z-index: 5000; overflow-y: auto;
            display: none; flex-direction: column;
        }

        h1 { font-size: 24px; }
        .letter-body { font-family: sans-serif; font-size: 16px; line-height: 1.6; text-align: left; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="youtube-player"></div>
    <div id="music-toggle" onclick="toggleMusic()">üéµ</div>

    <div id="ui-layer" style="position:absolute; top:20px; left:20px; display:none; z-index:100;">
        <div id="heart-bar" style="font-size: 20px;">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div id="scr-intro" class="screen">
        <div style="font-size: 60px; margin-bottom: 20px;">üçì</div>
        <h1>STRAWBERRY<br>MULTIVERSE</h1>
        <button id="start-btn" class="btn" onclick="startAdventure()" disabled>LOADING...</button>
    </div>

    <div id="scr-love2" class="screen hidden">
        <h1>DO YOU REALLY<br>LOVE ME?</h1>
        <button class="btn" onclick="nextLevel()">YES!</button>
        <button id="no-btn" class="btn">NO</button>
    </div>

    <div id="instruction-screen" class="screen hidden">
        <h2 id="ins-title"></h2>
        <p id="ins-text" style="font-size: 14px; margin: 20px;"></p>
        <button class="btn" onclick="startActualLvl()">I'M READY!</button>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h2 id="q-num" style="font-size: 14px;"></h2>
        <p id="q-text" style="font-size: 18px; margin-bottom: 25px;"></p>
        <div id="quiz-options" style="width: 100%;"></div>
    </div>

    <canvas id="mainCanvas"></canvas>

    <div id="scr-final" class="screen hidden">
        <h1>VICTORY!</h1>
        <div style="font-size: 70px; margin: 30px;">üçì‚ú®</div>
        <button class="btn" onclick="openLetter()">READ MY LETTER üíå</button>
    </div>

    <div id="letter-overlay">
        <h2>Happy 1st Month Aliii! üçì</h2>
        <div class="letter-body">
            Dear Lexi Merindo,<br><br>
            They say the first month is just the beginning, but with you, it feels like I've found my favorite person in the entire multiverse.<br><br>
            Even across the distance, every video call and every text makes me fall for you all over again. I can't wait for that first airport hug.<br><br>
            I love you more than all the strawberries in the world.<br><br>
            Yours Forever,<br>
            Cj Morales
        </div>
        <button class="btn" onclick="closeLetter()" style="margin-top: 30px;">CLOSE</button>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    const state = { 
        level: 0, hearts: 5, quizIndex: 0, 
        frames: 0, objects: [], isPaused: true,
        player: { x: 200, targetX: 200 }
    };

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-player', {
            height: '1', width: '1',
            videoId: 'Uj93hicGDNc',
            playerVars: { 
                'autoplay': 0, 'controls': 0, 'loop': 1, 
                'playlist': 'Uj93hicGDNc', 'origin': window.location.origin,
                'playsinline': 1 // Essential for iOS
            },
            events: { 'onReady': () => {
                const b = document.getElementById('start-btn');
                b.disabled = false;
                b.innerText = "START ADVENTURE";
            }}
        });
    }

    function startAdventure() {
        if (player && player.playVideo) player.playVideo();
        document.getElementById('scr-intro').classList.add('hidden');
        document.getElementById('scr-love2').classList.remove('hidden');
    }

    function toggleMusic() {
        if (!player || typeof player.getPlayerState !== 'function') return;
        player.getPlayerState() === 1 ? player.pauseVideo() : player.playVideo();
        document.getElementById('music-toggle').innerText = player.getPlayerState() === 1 ? "üîá" : "üéµ";
    }

    function nextLevel() {
        state.level++;
        document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
        document.getElementById('mainCanvas').style.display = 'none';
        state.isPaused = true;

        if(state.level === 3) {
            document.getElementById('scr-final').classList.remove('hidden');
            return;
        }

        const data = [null, 
            {t: "LVL 1: SYNC", d: "Answer 10 questions to sync our hearts!"},
            {t: "LVL 2: HARVEST", d: "Catch the strawberries but avoid the heartbreaks! Drag to move."}
        ][state.level];

        document.getElementById('instruction-screen').classList.remove('hidden');
        document.getElementById('ins-title').innerText = data.t;
        document.getElementById('ins-text').innerText = data.d;
    }

    function startActualLvl() {
        document.getElementById('instruction-screen').classList.add('hidden');
        document.getElementById('ui-layer').style.display = 'block';
        state.isPaused = false;
        if (state.level === 1) startQuiz();
        else { document.getElementById('mainCanvas').style.display = 'block'; runGameLoop(); }
    }

    function startQuiz() {
        const scr = document.getElementById('scr-quiz');
        scr.classList.remove('hidden');
        const quizData = [
            { q: "Who is more likely to cry during our first airport hug?", options: ["Me", "You", "Both"] },
            { q: "Who yaps the most during our late-night Video calls?", options: ["You", "Me", "Both"] },
            { q: "Who usually sends the first 'Good Morning' text?", options: ["Me", "You", "Both"] },
            { q: "Who is the master of sending the cutest reels?", options: ["Me", "You", "Both"] },
            { q: "Who is more likely to fall asleep first while on call?", options: ["Me", "You", "Both"] },
            { q: "Who fell in love first?", options: ["Me", "You", "Both"] },
            { q: "Who is most excited for our first date?", options: ["Me", "You", "Both"] },
            { q: "Who gives the best digital comfort?", options: ["Me", "You", "Both"] },
            { q: "Who is the most stubborn to hang up?", options: ["Me", "You", "Both"] },
            { q: "Ready to be my favorite person forever?", options: ["Yes!", "Yes (No cap)", "Endgame"] }
        ];

        const currentQ = quizData[state.quizIndex];
        document.getElementById('q-num').innerText = `SYNC Q${state.quizIndex + 1}`;
        document.getElementById('q-text').innerText = currentQ.q;
        const optContainer = document.getElementById('quiz-options');
        optContainer.innerHTML = '';
        currentQ.options.forEach(txt => {
            const b = document.createElement('button');
            b.className = 'btn'; b.innerText = txt;
            b.onclick = () => {
                state.quizIndex++;
                if (state.quizIndex < quizData.length) startQuiz();
                else { scr.classList.add('hidden'); nextLevel(); }
            };
            optContainer.appendChild(b);
        });
    }

    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');

    function runGameLoop() {
        if(state.isPaused) return;
        ctx.clearRect(0,0,canvas.width,canvas.height);
        state.player.x += (state.player.targetX - state.player.x) * 0.15;

        if(state.frames % 35 === 0) state.objects.push({x: Math.random()*(canvas.width-40), y: -50, t: Math.random()>0.2?'üçì':'üíî'});
        
        state.objects.forEach((o, i) => {
            o.y += 6;
            ctx.font = "30px Arial"; ctx.fillText(o.t, o.x, o.y);
            if(o.y > canvas.height - 100 && Math.abs(o.x - state.player.x) < 50) {
                if(o.t === 'üíî') state.hearts--;
                state.objects.splice(i, 1);
                document.getElementById('heart-bar').innerText = "‚ù§Ô∏è".repeat(Math.max(0, state.hearts));
            }
        });
        
        ctx.font = "60px Arial"; ctx.fillText("üß∫", state.player.x - 30, canvas.height - 60);
        state.frames++;
        if(state.hearts <= 0) { state.hearts = 5; state.objects = []; document.getElementById('heart-bar').innerText = "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è"; }
        if(state.frames > 800) nextLevel();
        else requestAnimationFrame(runGameLoop);
    }

    // Input Handling for all devices
    const getX = (e) => e.touches ? e.touches[0].clientX : e.clientX;
    const updateTarget = (e) => {
        const rect = canvas.getBoundingClientRect();
        state.player.targetX = getX(e) - rect.left;
    };
    canvas.addEventListener('mousemove', updateTarget);
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); updateTarget(e); }, {passive: false});

    const noBtn = document.getElementById('no-btn');
    const escape = () => { noBtn.style.left = Math.random()*70+'%'; noBtn.style.top = Math.random()*70+'%'; };
    noBtn.addEventListener('mouseover', escape);
    noBtn.addEventListener('touchstart', (e) => { e.preventDefault(); escape(); });

    function openLetter() { document.getElementById('letter-overlay').style.display = 'flex'; }
    function closeLetter() { document.getElementById('letter-overlay').style.display = 'none'; }
    function resize() { 
        canvas.width = document.getElementById('game-container').clientWidth; 
        canvas.height = document.getElementById('game-container').clientHeight; 
    }
    resize();
    window.addEventListener('resize', resize);
</script>
</body>
</html>
