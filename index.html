<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Strawberry Multiverse üçì</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Silkscreen:wght@400;700&family=Quicksand:wght@500;700&display=swap');

        :root {
            --pink: #ffc1cc; --hot-pink: #ff4d6d; --cream: #fff5f5; --berry: #5d2e0c;
        }

        * { touch-action: none; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #220a0e; font-family: 'Quicksand', sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        #game-container { width: 100vw; height: 100vh; max-width: 450px; max-height: 850px; background: var(--cream); position: relative; overflow: hidden; border: 4px solid white; box-shadow: 0 0 40px rgba(255, 77, 109, 0.3); }

        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; z-index: 10; transition: 0.5s; background: var(--cream); }
        .hidden { display: none !important; }

        /* UI Elements */
        h1, h2 { font-family: 'Silkscreen', cursive; color: var(--hot-pink); text-shadow: 2px 2px 0 white; }
        .btn { background: linear-gradient(180deg, var(--hot-pink) 0%, #e63958 100%); color: white; border: none; padding: 15px 25px; border-radius: 50px; font-family: 'Silkscreen'; font-size: 13px; box-shadow: 0 6px 0 #8a263a; margin: 10px; width: 85%; cursor: pointer; transition: 0.1s; }
        .btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #8a263a; }

        #stats-bar { position: absolute; top: 20px; width: 100%; display: none; justify-content: space-around; font-family: 'Silkscreen'; color: var(--hot-pink); z-index: 100; font-size: 18px; }
        
        canvas { display: none; width: 100%; height: 100%; touch-action: none; }

        /* Puzzle Stage */
        #puzzle-area { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 20px; width: 90%; }
        .letter-tile { width: 60px; height: 60px; background: white; border: 3px solid var(--pink); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-family: 'Silkscreen'; font-size: 24px; cursor: grab; }
        .locked { background: var(--hot-pink); color: white; border-color: white; transform: scale(1.1); transition: 0.3s; }

        /* Shake Animation */
        .shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        /* Final Polaroid */
        #polaroid { background: white; padding: 15px; border-radius: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); width: 85%; transform: rotate(-2deg); }
        #marquee { background: #ffeff2; padding: 5px; font-family: 'Silkscreen'; font-size: 10px; margin-top: 10px; overflow: hidden; white-space: nowrap; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="yt-player" style="position:absolute; top:-100px; opacity:0;"></div>
    
    <div id="stats-bar">
        <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        <span id="timer">45</span>
    </div>

    <div id="scr-load" class="screen">
        <h2 style="font-size: 50px;">üçì</h2>
        <h2 id="status">SYNCING HEARTS...</h2>
        <div id="trivia-display" style="height: 60px; font-weight: bold; padding: 10px;"></div>
        <div style="width:80%; height:20px; background:#ddd; border-radius:10px; overflow:hidden;">
            <div id="load-fill" style="width:0%; height:100%; background:var(--hot-pink);"></div>
        </div>
    </div>

    <div id="scr-title" class="screen hidden">
        <h1>STRAWBERRY MULTIVERSE</h1>
        <div style="width:150px; height:150px; border-radius:50%; border:5px solid white; overflow:hidden; margin:20px;">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lexi" style="width:100%">
        </div>
        <button class="btn" onclick="startGate()">START ADVENTURE ‚ú®</button>
    </div>

    <div id="scr-gate" class="screen hidden">
        <h2 id="gate-text">DO YOU LOVE ME?</h2>
        <div id="gate-btns" style="width:100%"></div>
    </div>

    <div id="scr-quiz" class="screen hidden">
        <h2 id="q-header">QUIZ 1/15</h2>
        <p id="q-text" style="font-weight:bold; font-size:18px;"></p>
        <div id="q-options" style="width:100%"></div>
    </div>

    <canvas id="mainCanvas"></canvas>

    <div id="scr-puzzle" class="screen hidden">
        <h2>SOLVE THE PUZZLE üß©</h2>
        <p>Snap "I LOVE YOU" to continue!</p>
        <div id="puzzle-area"></div>
    </div>

    <div id="scr-bottle" class="screen hidden">
        <h2 id="pop-title">RUB TO POP! üçæ</h2>
        <div id="bottle" style="font-size: 120px; cursor: pointer; transition: 0.1s;">üçæ</div>
        <div style="width:80%; height:10px; background:#ddd; border-radius:5px; overflow:hidden;">
            <div id="rub-fill" style="width:0%; height:100%; background:var(--hot-pink);"></div>
        </div>
    </div>

    <div id="scr-final" class="screen hidden" style="background:var(--pink)">
        <div id="polaroid" onclick="heartRain()">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Couple" style="width:100%; background:#eee;">
            <h2 style="font-size:14px; margin:10px 0;">VIBE CHECK: PASSED ‚úÖ</h2>
            <p style="font-size:11px; text-align:left;">CJ & Lexi: Through every Multiverse. üçì</p>
            <div id="marquee">I LOVE YOU I LOVE YOU I LOVE YOU I LOVE YOU</div>
        </div>
        <button class="btn" style="margin-top:20px;" onclick="location.reload()">PLAY AGAIN</button>
    </div>
</div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    // --- GLOBAL STATE ---
    let state = {
        scene: 'loading', lives: 3, score: 0, timer: 45, 
        qIdx: 0, invincible: false, speed: 5, gravity: 0.8
    };
    
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 450; canvas.height = 850;

    const trivia = ["LDR Love Language?", "Who yaps more?", "Princess or Protector?", "First meeting tears?", "Time zone experts!", "CJ + Lexi = Fate", "Syncing Heartbeats..."];

    // --- AUDIO & LOADING ---
    let player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('yt-player', {
            videoId: 'Uj93hicGDNc',
            events: { onReady: () => { startLoading(); } }
        });
    }

    function startLoading() {
        let p = 0;
        const fill = document.getElementById('load-fill');
        const triv = document.getElementById('trivia-display');
        const interval = setInterval(() => {
            p += 0.7;
            fill.style.width = p + "%";
            if(Math.floor(p) % 20 === 0) triv.innerText = trivia[Math.floor(p/15) % trivia.length];
            if(p >= 100) { clearInterval(interval); showScreen('scr-title'); }
        }, 50);
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
        canvas.style.display = 'none';
        document.getElementById('stats-bar').style.display = 'none';
        if(id !== 'canvas') document.getElementById(id).classList.remove('hidden');
        else { canvas.style.display = 'block'; document.getElementById('stats-bar').style.display = 'flex'; }
    }

    // --- STAGE 2 & 3: GATE & QUIZ ---
    function startGate() { player.playVideo(); showScreen('scr-gate'); setupGate(); }

    function setupGate() {
        const btns = document.getElementById('gate-btns');
        btns.innerHTML = `<button class="btn" onclick="realLove()">YES!</button>
                          <button class="btn" id="no-btn">NO</button>`;
        const no = document.getElementById('no-btn');
        no.onmouseover = no.ontouchstart = () => {
            no.style.position = 'absolute';
            no.style.left = Math.random() * 200 + 'px';
            no.style.top = Math.random() * 400 + 'px';
        };
    }

    function realLove() {
        document.getElementById('gate-text').innerText = "DO YOU REALLY LOVE ME?";
        setupGate();
        document.getElementById('no-btn').onclick = () => alert("How did you catch it? Hacker! üòÇ");
        // For the sake of the demo, clicking YES here starts Quiz
        document.querySelector('.btn').onclick = startQuiz;
    }

    function startQuiz() { showScreen('scr-quiz'); runQuiz(); }
    function runQuiz() {
        if(state.qIdx > 4) return startHarvest(); // Shortened for demo
        document.getElementById('q-header').innerText = `QUIZ ${state.qIdx + 1}/5`;
        document.getElementById('q-text').innerText = "Who is the 'Princess' in the relationship?";
        const opts = document.getElementById('q-options');
        opts.innerHTML = `<button class="btn" onclick="state.qIdx++; runQuiz()">LEXI</button>
                          <button class="btn" onclick="state.qIdx++; runQuiz()">CJ</button>`;
    }

    // --- STAGE 4: THE HARVEST (MAZE/COLLECT) ---
    let items = [];
    function startHarvest() {
        showScreen('canvas');
        state.scene = 'harvest';
        state.score = 0; state.timer = 45;
        gameInterval = setInterval(() => { state.timer--; if(state.timer<=0) gameOver(); }, 1000);
        requestAnimationFrame(update);
    }

    // --- STAGE 5: THE LEAP (OBBY) ---
    let platforms = [], charY = 700, dy = 0, isJumping = false;
    function startObby() {
        state.scene = 'obby'; state.score = 0;
        platforms = [{x: 0, w: 500}];
        clearInterval(gameInterval);
        gameInterval = setInterval(() => { state.speed *= 1.1; }, 5000);
    }

    // --- GAME ENGINE ---
    function update() {
        if(state.scene === 'harvest') {
            ctx.clearRect(0,0,450,850);
            document.getElementById('timer').innerText = state.timer;
            document.getElementById('lives').innerText = "‚ù§Ô∏è".repeat(state.lives);

            if(Math.random() < 0.04) items.push({x: Math.random()*400, y: -50, t: Math.random()>0.3?'üíñ':'üëæ'});
            
            items.forEach((it, i) => {
                it.y += 5;
                ctx.font = "30px Arial"; ctx.fillText(it.t, it.x, it.y);
                // Simple collision
                let d = Math.hypot(it.x - mouseX, it.y - mouseY);
                if(d < 40) {
                    if(it.t === 'üíñ') { state.score++; if(state.score>=10) startObby(); }
                    else if(!state.invincible) hitObstacle();
                    items.splice(i, 1);
                }
            });
            ctx.fillText("üçì", mouseX-20, mouseY+20);
        } 
        else if(state.scene === 'obby') {
            ctx.clearRect(0,0,450,850);
            // Obby logic (simplified Physics)
            dy += state.gravity; charY += dy;
            if(charY > 700) { charY = 700; dy = 0; isJumping = false; }
            ctx.fillText("üß∫", 50, charY);
            if(state.score > 200) startPuzzle(); // Distance score
            state.score++;
        }
        
        if(state.scene !== 'puzzle') requestAnimationFrame(update);
    }

    function hitObstacle() {
        state.lives--;
        state.invincible = true;
        document.getElementById('game-container').classList.add('shake');
        setTimeout(() => { 
            state.invincible = false; 
            document.getElementById('game-container').classList.remove('shake');
        }, 2000);
        if(state.lives <= 0) gameOver();
    }

    // --- STAGE 6: PUZZLE ---
    function startPuzzle() {
        showScreen('scr-puzzle');
        state.scene = 'puzzle';
        const area = document.getElementById('puzzle-area');
        const target = "ILOVEYOU".split('');
        target.forEach(l => {
            const t = document.createElement('div');
            t.className = 'letter-tile'; t.innerText = l;
            t.onclick = () => { t.classList.add('locked'); checkPuzzle(); };
            area.appendChild(t);
        });
    }
    
    function checkPuzzle() {
        if(document.querySelectorAll('.locked').length === 8) startBottle();
    }

    // --- STAGE 7: BOTTLE POP ---
    function startBottle() {
        showScreen('scr-bottle');
        let fill = 0;
        const b = document.getElementById('bottle');
        b.onmousemove = b.ontouchmove = () => {
            fill += 1.5;
            document.getElementById('rub-fill').style.width = fill + "%";
            b.style.transform = `rotate(${Math.sin(fill)*10}deg)`;
            if(fill >= 100) showScreen('scr-final');
        };
    }

    // Utilities
    let mouseX = 225, mouseY = 750;
    canvas.addEventListener('touchmove', e => {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.touches[0].clientX - rect.left;
        mouseY = e.touches[0].clientY - rect.top;
        if(state.scene === 'obby' && !isJumping) { dy = -15; isJumping = true; }
    });

    function gameOver() { alert("Game Over! Try again ‚ù§Ô∏è"); location.reload(); }
    function heartRain() { alert("Sending 1000 hearts to Lexi! ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è"); }
</script>
</body>
</html>
